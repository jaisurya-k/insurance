<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
<title>InsureTrack Pro ‚Äî AI-Powered Insurance Intelligence</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0/dist/chartjs-plugin-datalabels.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<style>
:root {
  --ink: #0f172a;
  --ink2: #1e293b;
  --panel: #1e293b;
  --panel2: #334155;
  --border: rgba(148,163,184,0.1);
  --border2: rgba(148,163,184,0.2);
  --accent: #3b82f6;
  --accent-hover: #2563eb;
  --teal: #14b8a6;
  --rose: #f43f5e;
  --amber: #f59e0b;
  --violet: #8b5cf6;
  --emerald: #10b981;
  --muted: #64748b;
  --text: #f1f5f9;
  --text2: #cbd5e1;
  --sidebar: 280px;
  --radius: 16px;
  --radius-sm: 10px;
  --shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
  --shadow-lg: 0 25px 50px -12px rgba(0,0,0,0.25);
}

*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%}
body{
  font-family:'Inter',sans-serif;
  background:var(--ink);
  color:var(--text);
  overflow-x:hidden;
  font-size:14px;
  line-height:1.6;
  -webkit-tap-highlight-color: transparent;
}

::-webkit-scrollbar{width:8px;height:8px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:10px}
::-webkit-scrollbar-thumb:hover{background:var(--muted)}

.glass-panel{
  background:rgba(30,41,59,0.6);
  backdrop-filter:blur(20px);
  -webkit-backdrop-filter:blur(20px);
  border:1px solid rgba(148,163,184,0.1);
}

.mesh{
  position:fixed;
  inset:0;
  z-index:0;
  pointer-events:none;
  background:
    radial-gradient(ellipse 80% 50% at 50% -20%, rgba(59,130,246,0.15), transparent),
    radial-gradient(ellipse 60% 50% at 0% 50%, rgba(139,92,246,0.1), transparent),
    radial-gradient(ellipse 60% 50% at 100% 50%, rgba(20,184,166,0.1), transparent);
  animation:meshMove 20s ease infinite;
}

@keyframes meshMove{
  0%,100%{opacity:1}
  50%{opacity:0.8}
}

.sidebar{
  position:fixed;
  left:0;
  top:0;
  width:var(--sidebar);
  height:100vh;
  background:linear-gradient(180deg, rgba(30,41,59,0.95) 0%, rgba(15,23,42,0.98) 100%);
  backdrop-filter:blur(20px);
  border-right:1px solid var(--border);
  display:flex;
  flex-direction:column;
  z-index:100;
  transition:transform .3s cubic-bezier(.4,0,.2,1);
  box-shadow:4px 0 24px rgba(0,0,0,0.1);
}

@media (max-width: 900px) {
  .sidebar {
    transform: translateX(-100%);
  }
  .sidebar.open {
    transform: translateX(0);
  }
}

.sidebar-logo{
  padding:32px 24px;
  display:flex;
  align-items:center;
  gap:14px;
  border-bottom:1px solid var(--border);
  background:rgba(59,130,246,0.05);
}

.logo-box{
  width:48px;
  height:48px;
  border-radius:14px;
  background:linear-gradient(135deg,#3b82f6,#8b5cf6);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:22px;
  color:#fff;
  flex-shrink:0;
  box-shadow:0 8px 16px rgba(59,130,246,0.3);
}

.logo-text{
  font-family:'Poppins',sans-serif;
  font-weight:800;
  font-size:18px;
  color:#fff;
  letter-spacing:-0.5px;
}

.logo-sub{
  font-size:10px;
  color:var(--muted);
  text-transform:uppercase;
  letter-spacing:2px;
  font-weight:600;
}

.nav-section{
  padding:24px 16px 0;
  flex:1;
  overflow-y:auto;
}

.nav-label{
  font-size:11px;
  color:var(--muted);
  text-transform:uppercase;
  letter-spacing:1.5px;
  padding:0 12px 12px;
  font-weight:700;
}

.nav-item{
  display:flex;
  align-items:center;
  gap:14px;
  padding:14px 16px;
  border-radius:12px;
  color:var(--text2);
  cursor:pointer;
  transition:all .25s cubic-bezier(.4,0,.2,1);
  font-size:14px;
  font-weight:500;
  margin-bottom:4px;
  border:none;
  background:none;
  width:100%;
  text-align:left;
  position:relative;
  overflow:hidden;
}

.nav-item::before{
  content:'';
  position:absolute;
  left:0;
  top:0;
  bottom:0;
  width:3px;
  background:var(--accent);
  transform:scaleY(0);
  transition:transform .25s;
}

.nav-item:hover{
  background:rgba(59,130,246,0.1);
  color:var(--text);
  transform:translateX(2px);
}

.nav-item.active{
  background:linear-gradient(135deg,rgba(59,130,246,0.15),rgba(139,92,246,0.1));
  color:#fff;
  box-shadow:0 4px 12px rgba(59,130,246,0.2);
}

.nav-item.active::before{
  transform:scaleY(1);
}

.nav-item .icon{
  width:38px;
  height:38px;
  border-radius:10px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:16px;
  background:rgba(255,255,255,0.05);
  transition:all .25s;
}

.nav-item.active .icon{
  background:linear-gradient(135deg,#3b82f6,#8b5cf6);
  color:#fff;
  box-shadow:0 4px 12px rgba(59,130,246,0.4);
}

.nav-bottom{
  padding:20px;
  border-top:1px solid var(--border);
  background:rgba(0,0,0,0.2);
}

.user-card{
  display:flex;
  align-items:center;
  gap:14px;
  padding:14px;
  border-radius:12px;
  background:rgba(59,130,246,0.08);
  cursor:pointer;
  transition:all .25s;
  border:1px solid rgba(59,130,246,0.15);
}

.user-card:hover{
  background:rgba(59,130,246,0.12);
  transform:translateY(-2px);
}

.user-avatar{
  width:42px;
  height:42px;
  border-radius:50%;
  background:linear-gradient(135deg,var(--accent),var(--violet));
  display:flex;
  align-items:center;
  justify-content:center;
  font-family:'Poppins',sans-serif;
  font-weight:700;
  font-size:15px;
  color:#fff;
  flex-shrink:0;
  box-shadow:0 4px 12px rgba(59,130,246,0.3);
}

.user-name{
  font-size:14px;
  font-weight:600;
  color:var(--text);
}

.user-role{
  font-size:12px;
  color:var(--muted);
}

.logout-btn{
  width:100%;
  margin-top:10px;
  padding:11px;
  border-radius:10px;
  background:rgba(244,63,94,0.12);
  border:1px solid rgba(244,63,94,0.2);
  color:var(--rose);
  font-size:13px;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  font-family:'Inter',sans-serif;
  font-weight:600;
  transition:all .25s;
}

.logout-btn:hover{
  background:rgba(244,63,94,0.2);
  transform:translateY(-2px);
}

.topbar{
  height:72px;
  background:rgba(30,41,59,0.8);
  backdrop-filter:blur(20px);
  border-bottom:1px solid var(--border);
  display:flex;
  align-items:center;
  gap:20px;
  padding:0 32px;
  position:sticky;
  top:0;
  z-index:50;
  box-shadow:0 4px 6px rgba(0,0,0,0.05);
}

@media (max-width: 600px) {
  .topbar {
    padding: 0 16px;
    gap: 10px;
  }
}

.topbar-title{
  font-family:'Poppins',sans-serif;
  font-size:20px;
  font-weight:700;
  flex:1;
  background:linear-gradient(135deg,#fff,#cbd5e1);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
}

.topbar-title span{
  background:linear-gradient(135deg,#3b82f6,#8b5cf6);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
}

.search-wrap{
  position:relative;
}

@media (max-width: 640px) {
  .search-wrap {
    display: none;
  }
}

.search-wrap input{
  background:rgba(15,23,42,0.6);
  border:1px solid var(--border2);
  border-radius:28px;
  padding:11px 20px 11px 46px;
  color:var(--text);
  font-size:13px;
  width:280px;
  outline:none;
  transition:all .3s;
  font-family:'Inter',sans-serif;
}

.search-wrap input:focus{
  border-color:var(--accent);
  width:340px;
  box-shadow:0 0 0 4px rgba(59,130,246,.15);
  background:rgba(15,23,42,0.9);
}

.search-wrap i{
  position:absolute;
  left:18px;
  top:50%;
  transform:translateY(-50%);
  color:var(--muted);
  font-size:14px;
  pointer-events:none;
}

.search-dropdown{
  position:absolute;
  top:calc(100% + 8px);
  left:0;
  width:380px;
  background:rgba(30,41,59,0.98);
  backdrop-filter:blur(20px);
  border:1px solid var(--border2);
  border-radius:var(--radius);
  padding:10px;
  z-index:200;
  display:none;
  box-shadow:var(--shadow-lg);
}

.search-dropdown.show{display:block}

.search-result-item{
  padding:12px 14px;
  border-radius:10px;
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:12px;
  transition:all .2s;
}

.search-result-item:hover{
  background:rgba(59,130,246,0.1);
}

.search-result-icon{
  width:36px;
  height:36px;
  border-radius:10px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:14px;
  flex-shrink:0;
}

.search-result-title{
  font-size:14px;
  font-weight:600;
  color:var(--text);
}

.search-result-sub{
  font-size:12px;
  color:var(--muted);
}

.notif-btn{
  width:42px;
  height:42px;
  border-radius:12px;
  background:rgba(15,23,42,0.6);
  border:1px solid var(--border2);
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  position:relative;
  color:var(--muted);
  font-size:16px;
  transition:all .25s;
  flex-shrink: 0;
}

.notif-btn:hover{
  border-color:var(--accent);
  color:var(--accent);
  background:rgba(59,130,246,0.1);
  transform:translateY(-2px);
}

.notif-badge{
  position:absolute;
  top:-4px;
  right:-4px;
  width:20px;
  height:20px;
  background:var(--rose);
  border-radius:50%;
  font-size:10px;
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
  font-weight:700;
  border:2px solid var(--panel);
  box-shadow:0 2px 8px rgba(244,63,94,0.4);
}

.menu-btn{
  display:none;
  width:42px;
  height:42px;
  border-radius:12px;
  background:rgba(15,23,42,0.6);
  border:1px solid var(--border2);
  align-items:center;
  justify-content:center;
  cursor:pointer;
  color:var(--text);
  font-size:18px;
  transition:all .25s;
  flex-shrink: 0;
}

@media (max-width: 900px) {
  .menu-btn {
    display: flex;
  }
}

.menu-btn:hover{
  background:rgba(59,130,246,0.1);
}

.app-wrap{
  display:flex;
  min-height:100vh;
  position:relative;
  z-index:1;
}

.main-area{
  flex:1;
  margin-left:var(--sidebar);
  min-height:100vh;
  display:flex;
  flex-direction:column;
}

@media (max-width: 900px) {
  .main-area {
    margin-left: 0;
  }
}

.page-content{
  flex:1;
  padding:32px;
  overflow-y:auto;
}

@media (max-width: 600px) {
  .page-content {
    padding: 20px 16px;
  }
}

.screen{
  display:none;
  animation:fadeUp .4s cubic-bezier(.4,0,.2,1);
}

.screen.active{display:block}

@keyframes fadeUp{
  from{opacity:0;transform:translateY(20px)}
  to{opacity:1;transform:translateY(0)}
}

.card{
  background:rgba(30,41,59,0.6);
  backdrop-filter:blur(20px);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:28px;
  box-shadow:0 4px 6px rgba(0,0,0,0.05);
  transition:all .3s;
}

@media (max-width: 600px) {
  .card {
    padding: 20px;
  }
}

.card:hover{
  border-color:var(--border2);
  box-shadow:0 8px 16px rgba(0,0,0,0.1);
}

.card-hd{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:24px;
  flex-wrap: wrap;
  gap: 10px;
}

.card-hd h3{
  font-family:'Poppins',sans-serif;
  font-size:16px;
  font-weight:700;
  color:var(--text);
  display:flex;
  align-items:center;
  gap:10px;
}

.card-hd h3 i{
  color:var(--accent);
  font-size:18px;
}

.stats-grid{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:20px;
  margin-bottom:28px;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: 1fr;
  }
}

.stat{
  background:rgba(30,41,59,0.6);
  backdrop-filter:blur(20px);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:26px 24px;
  position:relative;
  overflow:hidden;
  cursor:pointer;
  transition:all .3s cubic-bezier(.4,0,.2,1);
}

.stat::before{
  content:'';
  position:absolute;
  inset:0;
  opacity:0;
  transition:opacity .3s;
}

.stat:hover{
  transform:translateY(-6px);
  border-color:var(--border2);
  box-shadow:0 12px 24px rgba(0,0,0,0.15);
}

.stat:hover::before{opacity:1}

.stat.total::before{
  background:radial-gradient(circle at 80% 20%, rgba(59,130,246,.15), transparent 70%);
}

.stat.approved::before{
  background:radial-gradient(circle at 80% 20%, rgba(20,184,166,.15), transparent 70%);
}

.stat.rejected::before{
  background:radial-gradient(circle at 80% 20%, rgba(244,63,94,.15), transparent 70%);
}

.stat.pending::before{
  background:radial-gradient(circle at 80% 20%, rgba(245,158,11,.15), transparent 70%);
}

.stat-icon{
  width:52px;
  height:52px;
  border-radius:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:22px;
  margin-bottom:18px;
  box-shadow:0 4px 12px rgba(0,0,0,0.1);
}

.stat.total .stat-icon{
  background:linear-gradient(135deg,rgba(59,130,246,.2),rgba(59,130,246,.1));
  color:var(--accent);
}

.stat.approved .stat-icon{
  background:linear-gradient(135deg,rgba(20,184,166,.2),rgba(20,184,166,.1));
  color:var(--teal);
}

.stat.rejected .stat-icon{
  background:linear-gradient(135deg,rgba(244,63,94,.2),rgba(244,63,94,.1));
  color:var(--rose);
}

.stat.pending .stat-icon{
  background:linear-gradient(135deg,rgba(245,158,11,.2),rgba(245,158,11,.1));
  color:var(--amber);
}

.stat-num{
  font-family:'Poppins',sans-serif;
  font-size:38px;
  font-weight:800;
  line-height:1;
  color:#fff;
  margin-bottom:8px;
}

.stat-label{
  font-size:13px;
  color:var(--muted);
  font-weight:600;
  text-transform:uppercase;
  letter-spacing:1px;
}

.stat-change{
  font-size:12px;
  margin-top:12px;
  display:flex;
  align-items:center;
  gap:6px;
  font-weight:600;
}

.stat-change.up{color:var(--emerald)}
.stat-change.down{color:var(--rose)}

.badge{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:6px 13px;
  border-radius:24px;
  font-size:12px;
  font-weight:600;
  letter-spacing:0.3px;
}

.badge-pending{
  background:rgba(245,158,11,.15);
  color:var(--amber);
  border:1px solid rgba(245,158,11,.25);
}

.badge-approved{
  background:rgba(20,184,166,.15);
  color:var(--teal);
  border:1px solid rgba(20,184,166,.25);
}

.badge-rejected{
  background:rgba(244,63,94,.15);
  color:var(--rose);
  border:1px solid rgba(244,63,94,.25);
}

.badge-low{
  background:rgba(20,184,166,.12);
  color:var(--teal);
}

.badge-medium{
  background:rgba(245,158,11,.12);
  color:var(--amber);
}

.badge-high{
  background:rgba(244,63,94,.12);
  color:var(--rose);
}

.badge-fraud{
  background:rgba(244,63,94,.25);
  color:var(--rose);
  border:1px solid rgba(244,63,94,.35);
}

.badge-clean{
  background:rgba(20,184,166,.25);
  color:var(--teal);
  border:1px solid rgba(20,184,166,.35);
}

.ai-pill{
  display:inline-flex;
  align-items:center;
  gap:7px;
  padding:6px 14px;
  border-radius:24px;
  font-size:12px;
  font-weight:700;
  background:linear-gradient(135deg,rgba(59,130,246,.2),rgba(139,92,246,.2));
  color:#a5c8ff;
  border:1px solid rgba(59,130,246,.3);
  animation:pulse-glow 3s infinite;
  letter-spacing:0.5px;
}

@keyframes pulse-glow{
  0%,100%{box-shadow:0 0 10px rgba(59,130,246,.3)}
  50%{box-shadow:0 0 20px rgba(59,130,246,.5)}
}

.table-wrap{
  overflow-x:auto;
  border-radius:var(--radius);
  border:1px solid var(--border);
  background:rgba(15,23,42,0.4);
}

table{
  width:100%;
  border-collapse:collapse;
  min-width: 650px;
}

thead th{
  background:rgba(59,130,246,0.08);
  padding:16px 18px;
  text-align:left;
  font-size:12px;
  font-weight:700;
  color:var(--text2);
  text-transform:uppercase;
  letter-spacing:1px;
  white-space:nowrap;
  border-bottom:1px solid var(--border);
}

tbody td{
  padding:16px 18px;
  border-bottom:1px solid var(--border);
  font-size:14px;
  color:var(--text2);
  vertical-align:middle;
}

tbody tr:last-child td{border-bottom:none}

tbody tr{
  transition:all .2s;
  cursor:pointer;
}

tbody tr:hover{
  background:rgba(59,130,246,0.05);
}

tbody tr:hover td{
  color:var(--text);
}

.pol-num{
  font-family:'Poppins',sans-serif;
  font-size:14px;
  font-weight:700;
  color:var(--accent);
}

.cust-name{
  font-weight:600;
  color:var(--text);
}

.premium{
  font-family:'Poppins',sans-serif;
  font-weight:700;
  color:var(--teal);
}

.form-group{margin-bottom:22px}

.form-group label{
  display:flex;
  align-items:center;
  gap:8px;
  font-size:13px;
  font-weight:600;
  color:var(--text2);
  text-transform:uppercase;
  letter-spacing:1px;
  margin-bottom:10px;
}

.form-group label i{
  color:var(--accent);
  font-size:12px;
}

.form-control,.form-select{
  width:100%;
  background:rgba(15,23,42,0.6);
  border:1px solid var(--border2);
  border-radius:12px;
  padding:13px 16px;
  color:var(--text);
  font-size:14px;
  outline:none;
  transition:all .25s;
  font-family:'Inter',sans-serif;
}

.form-control:focus,.form-select:focus{
  border-color:var(--accent);
  box-shadow:0 0 0 4px rgba(59,130,246,.15);
  background:rgba(15,23,42,0.9);
}

.form-select option{
  background:var(--panel2);
}

textarea.form-control{
  resize:vertical;
  min-height:100px;
}

.form-row{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:20px;
}

@media (max-width: 640px) {
  .form-row {
    grid-template-columns: 1fr;
    gap: 0;
  }
}

.form-row-3{
  display:grid;
  grid-template-columns:1fr 1fr 1fr;
  gap:20px;
}

@media (max-width: 768px) {
  .form-row-3 {
    grid-template-columns: 1fr 1fr;
  }
}

@media (max-width: 480px) {
  .form-row-3 {
    grid-template-columns: 1fr;
  }
}

.btn{
  display:inline-flex;
  align-items:center;
  gap:10px;
  padding:12px 24px;
  border-radius:12px;
  font-size:14px;
  font-weight:600;
  cursor:pointer;
  border:none;
  transition:all .25s cubic-bezier(.4,0,.2,1);
  font-family:'Inter',sans-serif;
  letter-spacing:0.3px;
}

.btn-primary{
  background:linear-gradient(135deg,#3b82f6,#8b5cf6);
  color:#fff;
  box-shadow:0 4px 12px rgba(59,130,246,0.3);
}

.btn-primary:hover{
  transform:translateY(-3px);
  box-shadow:0 8px 20px rgba(59,130,246,0.4);
}

.btn-success{
  background:rgba(20,184,166,.15);
  color:var(--teal);
  border:1px solid rgba(20,184,166,.3);
}

.btn-success:hover{
  background:rgba(20,184,166,.25);
  transform:translateY(-2px);
}

.btn-danger{
  background:rgba(244,63,94,.15);
  color:var(--rose);
  border:1px solid rgba(244,63,94,.3);
}

.btn-danger:hover{
  background:rgba(244,63,94,.25);
  transform:translateY(-2px);
}

.btn-ghost{
  background:rgba(148,163,184,0.08);
  color:var(--text2);
  border:1px solid var(--border2);
}

.btn-ghost:hover{
  color:var(--text);
  border-color:var(--accent);
  background:rgba(59,130,246,0.1);
}

.btn-gold{
  background:rgba(245,158,11,.15);
  color:var(--amber);
  border:1px solid rgba(245,158,11,.3);
}

.btn-gold:hover{
  background:rgba(245,158,11,.25);
  transform:translateY(-2px);
}

.btn-sm{
  padding:9px 16px;
  font-size:13px;
}

.btn-icon{
  width:38px;
  height:38px;
  padding:0;
  border-radius:10px;
  justify-content:center;
}

.ai-bar{
  background:linear-gradient(135deg, rgba(59,130,246,.12), rgba(139,92,246,.08));
  border:1px solid rgba(59,130,246,.2);
  border-radius:var(--radius);
  padding:18px 24px;
  display:flex;
  align-items:center;
  gap:16px;
  margin-bottom:28px;
  box-shadow:0 4px 12px rgba(59,130,246,0.1);
  flex-wrap: wrap;
}

.ai-bar-icon{
  width:44px;
  height:44px;
  border-radius:12px;
  background:linear-gradient(135deg,#3b82f6,#8b5cf6);
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
  font-size:18px;
  flex-shrink:0;
  box-shadow:0 4px 12px rgba(59,130,246,0.4);
}

.ai-bar-text{
  font-size:14px;
  color:var(--text2);
  line-height:1.6;
  flex: 1;
}

.ai-bar-text strong{
  color:var(--accent);
  font-weight:700;
}

.risk-bar{
  height:10px;
  background:rgba(148,163,184,0.1);
  border-radius:5px;
  overflow:hidden;
  margin:10px 0;
}

.risk-fill{
  height:100%;
  background:linear-gradient(90deg,var(--teal),var(--amber),var(--rose));
  border-radius:5px;
  transition:width .6s cubic-bezier(.4,0,.2,1);
}

.chart-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:24px;
  margin-bottom:28px;
}

@media (max-width: 768px) {
  .chart-grid {
    grid-template-columns: 1fr;
  }
}

.chart-grid-3{
  display:grid;
  grid-template-columns:2fr 1fr;
  gap:24px;
  margin-bottom:28px;
}

@media (max-width: 768px) {
  .chart-grid-3 {
    grid-template-columns: 1fr;
  }
}

.chart-box{
  position:relative;
  height:260px;
  width: 100%;
}

.chart-box canvas{
  width:100% !important;
  height: 100% !important;
}

.timeline{
  position:relative;
  padding-left:32px;
}

.timeline::before{
  content:'';
  position:absolute;
  left:11px;
  top:4px;
  bottom:4px;
  width:2px;
  background:linear-gradient(180deg, var(--accent), var(--violet));
  opacity:0.3;
}

.tl-item{
  position:relative;
  margin-bottom:20px;
}

.tl-dot{
  width:22px;
  height:22px;
  border-radius:50%;
  position:absolute;
  left:-26px;
  top:2px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:9px;
  border:3px solid var(--panel);
  box-shadow:0 2px 8px rgba(0,0,0,0.2);
}

.tl-dot.success{background:var(--teal);color:#fff}
.tl-dot.danger{background:var(--rose);color:#fff}
.tl-dot.info{background:var(--accent);color:#fff}

.tl-title{
  font-size:14px;
  font-weight:600;
  color:var(--text);
}

.tl-sub{
  font-size:13px;
  color:var(--muted);
  margin-top:2px;
}

.tl-time{
  font-size:11px;
  color:var(--muted);
  margin-top:6px;
}

.progress-bar-wrap{
  height:12px;
  background:rgba(148,163,184,.08);
  border-radius:6px;
  overflow:hidden;
  margin-top:12px;
}

.progress-bar-fill{
  height:100%;
  background:linear-gradient(90deg,#3b82f6,#8b5cf6);
  border-radius:6px;
  transition:width .8s cubic-bezier(.4,0,.2,1);
  box-shadow:0 0 12px rgba(59,130,246,0.5);
}

.actions-grid{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:20px;
  margin-bottom:28px;
}

@media (max-width: 768px) {
  .actions-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 480px) {
  .actions-grid {
    grid-template-columns: 1fr;
  }
}

.action-card{
  background:rgba(30,41,59,0.6);
  backdrop-filter:blur(20px);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:26px 22px;
  text-align:center;
  cursor:pointer;
  transition:all .3s cubic-bezier(.4,0,.2,1);
  position:relative;
  overflow:hidden;
}

.action-card::after{
  content:'';
  position:absolute;
  inset:0;
  opacity:0;
  transition:opacity .3s;
  border-radius:var(--radius);
}

.action-card:hover{
  transform:translateY(-8px);
  border-color:var(--border2);
  box-shadow:0 12px 28px rgba(0,0,0,0.15);
}

.action-card:hover::after{opacity:1}

.action-card.ac1::after{
  background:radial-gradient(circle at 50% 0%, rgba(59,130,246,.15), transparent 70%);
}

.action-card.ac2::after{
  background:radial-gradient(circle at 50% 0%, rgba(20,184,166,.15), transparent 70%);
}

.action-card.ac3::after{
  background:radial-gradient(circle at 50% 0%, rgba(245,158,11,.15), transparent 70%);
}

.action-card.ac4::after{
  background:radial-gradient(circle at 50% 0%, rgba(139,92,246,.15), transparent 70%);
}

.action-icon{
  width:64px;
  height:64px;
  border-radius:16px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:28px;
  margin:0 auto 16px;
  position:relative;
  z-index:1;
  box-shadow:0 4px 12px rgba(0,0,0,0.15);
}

.ac1 .action-icon{
  background:linear-gradient(135deg, rgba(59,130,246,.2), rgba(59,130,246,.1));
  color:var(--accent);
}

.ac2 .action-icon{
  background:linear-gradient(135deg, rgba(20,184,166,.2), rgba(20,184,166,.1));
  color:var(--teal);
}

.ac3 .action-icon{
  background:linear-gradient(135deg, rgba(245,158,11,.2), rgba(245,158,11,.1));
  color:var(--amber);
}

.ac4 .action-icon{
  background:linear-gradient(135deg, rgba(139,92,246,.2), rgba(139,92,246,.1));
  color:var(--violet);
}

.action-card h5{
  font-family:'Poppins',sans-serif;
  font-size:15px;
  font-weight:700;
  color:var(--text);
  margin-bottom:6px;
  position:relative;
  z-index:1;
}

.action-card p{
  font-size:13px;
  color:var(--muted);
  position:relative;
  z-index:1;
}

.filter-bar{
  background:rgba(30,41,59,0.6);
  backdrop-filter:blur(20px);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:20px 24px;
  margin-bottom:24px;
  display:flex;
  gap:14px;
  align-items:center;
  flex-wrap:wrap;
}

.filter-bar .form-select{
  width:180px;
  padding:10px 14px;
  font-size:13px;
}

.filter-bar input{
  background:rgba(15,23,42,0.6);
  border:1px solid var(--border2);
  border-radius:12px;
  padding:10px 14px;
  color:var(--text);
  font-size:13px;
  outline:none;
  font-family:'Inter',sans-serif;
  width:220px;
  transition:all .25s;
}

.filter-bar input:focus{
  border-color:var(--accent);
  box-shadow:0 0 0 3px rgba(59,130,246,.1);
}

.filter-label{
  font-size:13px;
  color:var(--muted);
  font-weight:700;
  text-transform:uppercase;
  letter-spacing:1px;
}

.chatbot-wrap{
  position:fixed;
  bottom:28px;
  right:28px;
  z-index:999;
}

.chat-toggle{
  width:60px;
  height:60px;
  border-radius:50%;
  background:linear-gradient(135deg,#3b82f6,#8b5cf6);
  border:none;
  color:#fff;
  font-size:26px;
  cursor:pointer;
  box-shadow:0 8px 24px rgba(59,130,246,0.4);
  transition:all .3s;
  display:flex;
  align-items:center;
  justify-content:center;
}

.chat-toggle:hover{
  transform:scale(1.1);
  box-shadow:0 12px 32px rgba(59,130,246,0.5);
}

.chat-window{
  display:none;
  flex-direction:column;
  position:absolute;
  bottom:76px;
  right:0;
  width:380px;
  height:540px;
  background:rgba(30,41,59,0.98);
  backdrop-filter:blur(20px);
  border:1px solid var(--border2);
  border-radius:24px;
  overflow:hidden;
  box-shadow:0 24px 60px rgba(0,0,0,0.5);
}

@media (max-width: 480px) {
  .chat-window {
    width: calc(100vw - 32px);
    right: -10px;
  }
}

.chat-window.open{
  display:flex;
  animation:slideUp .3s ease;
}

@keyframes slideUp{
  from{opacity:0;transform:translateY(20px)}
  to{opacity:1;transform:translateY(0)}
}

.chat-hd{
  background:linear-gradient(135deg,#1e293b,#1a1f35);
  padding:20px 24px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  border-bottom:1px solid var(--border);
}

.chat-hd-left{
  display:flex;
  align-items:center;
  gap:12px;
}

.chat-hd-avatar{
  width:40px;
  height:40px;
  border-radius:50%;
  background:linear-gradient(135deg,#3b82f6,#8b5cf6);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:18px;
  color:#fff;
  box-shadow:0 4px 12px rgba(59,130,246,0.3);
}

.chat-hd h5{
  font-family:'Poppins',sans-serif;
  font-size:15px;
  font-weight:700;
  color:#fff;
  margin:0;
}

.chat-hd p{
  font-size:12px;
  color:var(--teal);
  margin:0;
}

.chat-close{
  background:none;
  border:none;
  color:var(--muted);
  font-size:18px;
  cursor:pointer;
  padding:6px;
  transition:color .2s;
}

.chat-close:hover{
  color:var(--text);
}

.chat-messages{
  flex:1;
  overflow-y:auto;
  padding:20px;
  display:flex;
  flex-direction:column;
  gap:14px;
}

.msg{
  display:flex;
  gap:10px;
  animation:fadeUp .3s ease;
}

.msg.user{flex-direction:row-reverse}

.msg-av{
  width:34px;
  height:34px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:14px;
  flex-shrink:0;
}

.msg-av.bot{
  background:linear-gradient(135deg,#3b82f6,#8b5cf6);
  color:#fff;
  box-shadow:0 2px 8px rgba(59,130,246,0.3);
}

.msg-av.user{
  background:rgba(20,184,166,.2);
  color:var(--teal);
  border:1px solid rgba(20,184,166,.3);
}

.msg-bubble{
  padding:12px 16px;
  border-radius:14px;
  font-size:14px;
  line-height:1.6;
  max-width:75%;
}

.msg.bot .msg-bubble{
  background:rgba(51,65,85,0.6);
  color:var(--text2);
  border:1px solid var(--border);
}

.msg.user .msg-bubble{
  background:linear-gradient(135deg, rgba(59,130,246,.25), rgba(139,92,246,.2));
  color:var(--text);
  border:1px solid rgba(59,130,246,.25);
}

.chat-input-wrap{
  padding:16px;
  border-top:1px solid var(--border);
  display:flex;
  gap:10px;
  background:rgba(15,23,42,0.5);
}

.chat-input-wrap input{
  flex:1;
  background:rgba(15,23,42,0.8);
  border:1px solid var(--border2);
  border-radius:24px;
  padding:11px 18px;
  color:var(--text);
  font-size:14px;
  outline:none;
  font-family:'Inter',sans-serif;
  transition:all .25s;
}

.chat-input-wrap input:focus{
  border-color:var(--accent);
  box-shadow:0 0 0 3px rgba(59,130,246,.1);
}

.chat-send{
  width:42px;
  height:42px;
  border-radius:50%;
  background:linear-gradient(135deg,#3b82f6,#8b5cf6);
  border:none;
  color:#fff;
  font-size:16px;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-shrink:0;
  transition:all .25s;
  box-shadow:0 4px 12px rgba(59,130,246,0.3);
}

.chat-send:hover{
  transform:scale(1.05);
}

.typing-dots{
  display:flex;
  gap:5px;
  padding:5px 0;
}

.typing-dots span{
  width:8px;
  height:8px;
  background:var(--accent);
  border-radius:50%;
  animation:bounce 1.4s infinite;
}

.typing-dots span:nth-child(2){animation-delay:.16s}
.typing-dots span:nth-child(3){animation-delay:.32s}

@keyframes bounce{
  0%,80%,100%{transform:scale(0.5);opacity:.4}
  40%{transform:scale(1);opacity:1}
}

.login-wrap{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:24px;
}

.login-card{
  width:100%;
  max-width:980px;
  background:rgba(30,41,59,0.9);
  backdrop-filter:blur(20px);
  border:1px solid var(--border2);
  border-radius:28px;
  overflow:hidden;
  display:grid;
  grid-template-columns:1fr 1fr;
  box-shadow:0 40px 80px rgba(0,0,0,0.4);
}

@media (max-width: 768px) {
  .login-card {
    grid-template-columns: 1fr;
  }
}

.login-left{
  padding:64px 52px;
  background:linear-gradient(160deg, #1e293b, #1a1e3e);
  position:relative;
  overflow:hidden;
}

@media (max-width: 768px) {
  .login-left {
    display: none;
  }
}

.login-left::before{
  content:'';
  position:absolute;
  width:420px;
  height:420px;
  border-radius:50%;
  border:1px solid rgba(59,130,246,.12);
  top:-120px;
  right:-120px;
}

.login-left::after{
  content:'';
  position:absolute;
  width:280px;
  height:280px;
  border-radius:50%;
  border:1px solid rgba(139,92,246,.12);
  bottom:-60px;
  left:-60px;
}

.login-brand{
  display:flex;
  align-items:center;
  gap:14px;
  margin-bottom:52px;
  position:relative;
  z-index:1;
}

.login-brand-icon{
  width:52px;
  height:52px;
  border-radius:14px;
  background:linear-gradient(135deg,#3b82f6,#8b5cf6);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:24px;
  color:#fff;
  box-shadow:0 8px 20px rgba(59,130,246,0.4);
}

.login-brand-text{
  font-family:'Poppins',sans-serif;
  font-weight:800;
  font-size:20px;
  color:#fff;
  letter-spacing:-0.5px;
}

.login-hero-text{
  position:relative;
  z-index:1;
}

.login-hero-text h1{
  font-family:'Poppins',sans-serif;
  font-size:40px;
  font-weight:800;
  color:#fff;
  line-height:1.2;
  margin-bottom:18px;
}

.login-hero-text h1 span{
  background:linear-gradient(135deg,#3b82f6,#8b5cf6);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
}

.login-hero-text p{
  color:rgba(255,255,255,.6);
  font-size:15px;
  line-height:1.7;
  margin-bottom:36px;
}

.login-feature{
  display:flex;
  align-items:center;
  gap:12px;
  margin-bottom:14px;
  color:rgba(255,255,255,.75);
  font-size:14px;
  font-weight:500;
}

.login-feature i{
  color:var(--teal);
  font-size:16px;
}

.login-right{
  padding:64px 52px;
  background:rgba(15,23,42,0.4);
}

@media (max-width: 600px) {
  .login-right {
    padding: 40px 24px;
  }
}

.login-right h2{
  font-family:'Poppins',sans-serif;
  font-size:28px;
  font-weight:800;
  color:var(--text);
  margin-bottom:8px;
}

.login-right p{
  color:var(--muted);
  font-size:14px;
  margin-bottom:36px;
}

.login-form .form-group{margin-bottom:22px}
.login-form .form-group label{font-size:12px;margin-bottom:8px}

.alert{
  padding:16px 20px;
  border-radius:12px;
  display:flex;
  align-items:center;
  gap:12px;
  font-size:14px;
  margin-bottom:18px;
  animation:fadeUp .3s ease;
  font-weight:500;
}

.alert-success{
  background:rgba(20,184,166,.12);
  border:1px solid rgba(20,184,166,.25);
  color:var(--teal);
}

.alert-info{
  background:rgba(59,130,246,.12);
  border:1px solid rgba(59,130,246,.25);
  color:var(--accent);
}

.alert-warning{
  background:rgba(245,158,11,.12);
  border:1px solid rgba(245,158,11,.25);
  color:var(--amber);
}

.alert-danger{
  background:rgba(244,63,94,.12);
  border:1px solid rgba(244,63,94,.25);
  color:var(--rose);
}

.metric-trio{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:20px;
  margin-bottom:28px;
}

@media (max-width: 640px) {
  .metric-trio {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 480px) {
  .metric-trio {
    grid-template-columns: 1fr;
  }
}

.metric-box{
  background:rgba(30,41,59,0.6);
  backdrop-filter:blur(20px);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:24px;
  text-align:center;
  transition:all .3s;
}

.metric-box:hover{
  transform:translateY(-4px);
  border-color:var(--border2);
  box-shadow:0 8px 20px rgba(0,0,0,0.1);
}

.metric-box .metric-val{
  font-family:'Poppins',sans-serif;
  font-size:32px;
  font-weight:800;
  color:#fff;
  margin-bottom:6px;
}

.metric-box .metric-label{
  font-size:12px;
  color:var(--muted);
  text-transform:uppercase;
  letter-spacing:1px;
  font-weight:600;
}

.spinner{
  display:inline-block;
  width:16px;
  height:16px;
  border:2px solid rgba(59,130,246,.3);
  border-top-color:var(--accent);
  border-radius:50%;
  animation:spin .8s linear infinite;
}

@keyframes spin{to{transform:rotate(360deg)}}

.page-hd{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:28px;
  flex-wrap: wrap;
  gap: 16px;
}

.page-hd-left{
  display:flex;
  align-items:center;
  gap:16px;
  flex-wrap: wrap;
}

.page-hd-icon{
  width:52px;
  height:52px;
  border-radius:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:22px;
  box-shadow:0 4px 12px rgba(0,0,0,0.15);
  flex-shrink: 0;
}

.page-hd h2{
  font-family:'Poppins',sans-serif;
  font-size:24px;
  font-weight:800;
  color:#fff;
}

.page-hd small{
  font-size:13px;
  color:var(--muted);
  font-weight:500;
}

.page-hd-actions{
  display:flex;
  gap:12px;
  align-items:center;
  flex-wrap: wrap;
}

.insight-block{
  background:rgba(59,130,246,.08);
  border:1px solid rgba(59,130,246,.15);
  border-radius:12px;
  padding:18px;
  margin-bottom:16px;
}

.insight-block:last-child{margin-bottom:0}

.insight-block h6{
  font-family:'Poppins',sans-serif;
  font-size:14px;
  font-weight:700;
  color:var(--accent);
  margin-bottom:12px;
  display:flex;
  align-items:center;
  gap:8px;
}

.insight-block ul,.insight-block ol{
  padding-left:22px;
  font-size:14px;
  color:var(--text2);
  line-height:1.9;
}

.upload-area{
  border:2px dashed var(--border2);
  border-radius:var(--radius);
  padding:44px 24px;
  text-align:center;
  cursor:pointer;
  transition:all .3s;
  margin-bottom:24px;
}

.upload-area:hover{
  border-color:var(--accent);
  background:rgba(59,130,246,.05);
}

.upload-area i{
  font-size:44px;
  color:var(--accent);
  margin-bottom:12px;
}

.voice-btn{
  width:42px;
  height:42px;
  border-radius:50%;
  background:linear-gradient(135deg,#f59e0b,#f43f5e);
  border:none;
  color:#fff;
  cursor:pointer;
  font-size:18px;
  transition:all .25s;
  box-shadow:0 4px 12px rgba(245,158,11,0.3);
  flex-shrink: 0;
}

.voice-btn:hover{
  transform:scale(1.05);
}

.voice-btn.listening{
  animation:pulse 1s infinite;
}

@keyframes pulse{
  0%{box-shadow:0 0 0 0 rgba(245,158,11,.7)}
  70%{box-shadow:0 0 0 12px rgba(245,158,11,0)}
  100%{box-shadow:0 0 0 0 rgba(245,158,11,0)}
}

.fraud-indicator{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:5px 12px;
  border-radius:24px;
  font-size:12px;
  font-weight:600;
}

.collab-badge{
  position:absolute;
  top:-6px;
  right:-6px;
  width:22px;
  height:22px;
  border-radius:50%;
  background:var(--teal);
  border:2px solid var(--panel);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:10px;
  color:#fff;
  font-weight:700;
  box-shadow:0 2px 8px rgba(20,184,166,0.4);
}

.export-menu{
  position:relative;
  display:inline-block;
}

.export-dropdown{
  position:absolute;
  top:100%;
  right:0;
  background:rgba(30,41,59,0.98);
  backdrop-filter:blur(20px);
  border:1px solid var(--border2);
  border-radius:12px;
  padding:10px;
  min-width:170px;
  display:none;
  z-index:100;
  box-shadow:var(--shadow-lg);
  margin-top:6px;
}

.export-menu:hover .export-dropdown{display:block}

.export-item{
  padding:10px 14px;
  font-size:13px;
  cursor:pointer;
  transition:background .2s;
  border-radius:8px;
  display:flex;
  align-items:center;
  gap:10px;
}

.export-item:hover{
  background:rgba(59,130,246,0.1);
}

.calendar-heatmap{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:5px;
  margin-top:18px;
}

.heatmap-cell{
  aspect-ratio:1;
  border-radius:5px;
  font-size:0;
  transition:transform .2s;
  cursor:pointer;
}

.heatmap-cell:hover{
  transform:scale(1.15);
}

.heatmap-cell[data-level="0"]{background:rgba(59,130,246,.12)}
.heatmap-cell[data-level="1"]{background:rgba(59,130,246,.3)}
.heatmap-cell[data-level="2"]{background:rgba(59,130,246,.5)}
.heatmap-cell[data-level="3"]{background:rgba(59,130,246,.7)}
.heatmap-cell[data-level="4"]{background:rgba(59,130,246,.9)}

.recommendation-card{
  background:linear-gradient(135deg, rgba(59,130,246,.12), rgba(139,92,246,.12));
  border:1px solid rgba(59,130,246,.25);
  border-radius:var(--radius);
  padding:18px;
  margin-bottom:12px;
  transition:all .25s;
}

.recommendation-card:hover{
  transform:translateY(-2px);
  box-shadow:0 8px 16px rgba(0,0,0,0.1);
}

.recommendation-card h4{
  color:var(--accent);
  font-size:15px;
  margin-bottom:10px;
  font-weight:700;
}

.recommendation-score{
  width:44px;
  height:44px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:700;
  font-size:13px;
}

.score-high{
  background:rgba(20,184,166,.25);
  color:var(--teal);
  border:2px solid rgba(20,184,166,.4);
}

.score-medium{
  background:rgba(245,158,11,.25);
  color:var(--amber);
  border:2px solid rgba(245,158,11,.4);
}

.score-low{
  background:rgba(244,63,94,.25);
  color:var(--rose);
  border:2px solid rgba(244,63,94,.4);
}

.export-btn-group{
  display:flex;
  gap:10px;
}

.apex-chart{
  width:100%;
  height:100%;
  min-height:280px;
}

.w-100 {
  width: 100%;
  justify-content: center;
}

/* Mobile Responsive Dashboard Improvements */
@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stat {
    padding: 20px 16px;
  }
  
  .stat-num {
    font-size: 28px;
  }
  
  .stat-icon {
    width: 44px;
    height: 44px;
    font-size: 18px;
  }
  
  .actions-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
  }
  
  .action-card {
    padding: 20px 16px;
  }
  
  .action-icon {
    width: 52px;
    height: 52px;
    font-size: 22px;
  }
  
  .action-card h5 {
    font-size: 14px;
  }
  
  .action-card p {
    font-size: 12px;
  }
  
  .chart-box {
    height: 220px;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: 1fr;
  }
  
  .stat {
    padding: 18px 14px;
  }
  
  .stat-num {
    font-size: 32px;
  }
  
  .stat-icon {
    width: 48px;
    height: 48px;
    font-size: 20px;
    margin-bottom: 14px;
  }
  
  .actions-grid {
    grid-template-columns: 1fr;
  }
  
  .action-card {
    padding: 18px 14px;
    display: flex;
    align-items: center;
    text-align: left;
    gap: 16px;
  }
  
  .action-icon {
    margin: 0;
    width: 48px;
    height: 48px;
    font-size: 20px;
  }
  
  .action-card h5 {
    margin-bottom: 4px;
  }
  
  .action-card p {
    margin: 0;
  }
  
  .chart-grid-3,
  .chart-grid {
    gap: 16px;
  }
  
  .card {
    padding: 16px;
  }
  
  .card-hd {
    margin-bottom: 16px;
  }
  
  .card-hd h3 {
    font-size: 15px;
  }
  
  .ai-bar {
    padding: 14px 16px;
  }
  
  .ai-bar-icon {
    width: 36px;
    height: 36px;
    font-size: 16px;
  }
  
  .ai-bar-text {
    font-size: 13px;
  }
  
  .page-hd h2 {
    font-size: 20px;
  }
  
  .page-hd-icon {
    width: 44px;
    height: 44px;
    font-size: 18px;
  }
  
  .btn {
    padding: 10px 18px;
    font-size: 13px;
  }
}

/* Touch-friendly improvements */
@media (max-width: 768px) {
  .nav-item,
  .btn,
  .action-card,
  .stat {
    cursor: pointer;
    -webkit-tap-highlight-color: transparent;
  }
  
  .nav-item:active,
  .btn:active,
  .action-card:active,
  .stat:active {
    transform: scale(0.98);
    opacity: 0.9;
  }
  
  .table-wrap {
    -webkit-overflow-scrolling: touch;
  }
  
  select,
  input,
  textarea {
    font-size: 16px !important; /* Prevents zoom on iOS */
  }
}
</style>
</head>
<body>
<div class="mesh"></div>

<!-- ‚ïê‚ïê‚ïê LOGIN ‚ïê‚ïê‚ïê -->
<div id="loginScreen" class="screen active" style="display:block">
  <div class="login-wrap">
    <div class="login-card">
      <div class="login-left">
        <div class="login-brand">
          <div class="login-brand-icon"><i class="fas fa-shield-halved"></i></div>
          <span class="login-brand-text">InsureTrack Pro</span>
        </div>
        <div class="login-hero-text">
          <h1>Smarter <span>Insurance</span> Management</h1>
          <p>AI-powered policy analytics, real-time risk scoring, and predictive insights ‚Äî all in one platform.</p>
          <div class="login-feature"><i class="fas fa-check-circle"></i> Smart Risk Assessment</div>
          <div class="login-feature"><i class="fas fa-check-circle"></i> Automated Verification</div>
          <div class="login-feature"><i class="fas fa-check-circle"></i> Live Analytics Charts</div>
          <div class="login-feature"><i class="fas fa-check-circle"></i> 24/7 AI Assistant</div>
        </div>
      </div>
      <div class="login-right">
        <h2>Sign In</h2>
        <p>Welcome back ‚Äî enter your credentials below</p>
        <form class="login-form" onsubmit="handleLogin(event)">
          <div class="form-group">
            <label><i class="fas fa-user"></i> Username</label>
            <input type="text" class="form-control" id="username" placeholder="Your name or email" required>
          </div>
          <div class="form-group">
            <label><i class="fas fa-lock"></i> Password</label>
            <input type="password" class="form-control" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
          </div>
          <div class="form-group">
            <label><i class="fas fa-user-tag"></i> Role</label>
            <select class="form-select" id="role" required>
              <option value="">Select role...</option>
              <option value="Administrator">üîê Administrator</option>
              <option value="Insurance Agent">üìã Insurance Agent</option>
              <option value="Quality Verifier">‚úÖ Quality Verifier</option>
              <option value="Manager">üëî Manager</option>
            </select>
          </div>
          <button type="submit" class="btn btn-primary w-100" style="width:100%;justify-content:center;padding:14px">
            <i class="fas fa-sign-in-alt"></i> Sign In
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê APP ‚ïê‚ïê‚ïê -->
<div id="app" style="display:none">
  <div class="app-wrap">
    <!-- SIDEBAR -->
    <nav class="sidebar" id="sidebar">
      <div class="sidebar-logo">
        <div class="logo-box"><i class="fas fa-shield-halved"></i></div>
        <div><div class="logo-text">InsureTrack</div><div class="logo-sub">Pro</div></div>
      </div>
      <div class="nav-section">
        <div class="nav-label">Menu</div>
        <button class="nav-item active" data-screen="dashboard" onclick="showScreen('dashboard',this)">
          <div class="icon"><i class="fas fa-chart-line"></i></div> Dashboard
        </button>
        <button class="nav-item" data-screen="policyEntry" onclick="showScreen('policyEntry',this)">
          <div class="icon"><i class="fas fa-file-circle-plus"></i></div> New Policy
        </button>
        <button class="nav-item" data-screen="verification" onclick="showScreen('verification',this)">
          <div class="icon"><i class="fas fa-clipboard-check"></i></div> Verification
        </button>
        <button class="nav-item" data-screen="aiInsights" onclick="showScreen('aiInsights',this)">
          <div class="icon"><i class="fas fa-brain"></i></div> AI Insights
        </button>
        <button class="nav-item" data-screen="reports" onclick="showScreen('reports',this)">
          <div class="icon"><i class="fas fa-chart-bar"></i></div> Reports
        </button>
        <button class="nav-item" data-screen="admin" onclick="showScreen('admin',this)">
          <div class="icon"><i class="fas fa-users-gear"></i></div> Team
        </button>
        <button class="nav-item" data-screen="settings" onclick="showScreen('settings',this)">
          <div class="icon"><i class="fas fa-cog"></i></div> Settings
        </button>
        <button class="nav-item" data-screen="advancedAnalytics" onclick="showScreen('advancedAnalytics',this)">
          <div class="icon"><i class="fas fa-chart-simple"></i></div> Advanced Analytics
        </button>
        <button class="nav-item" data-screen="fraudDetection" onclick="showScreen('fraudDetection',this)">
          <div class="icon"><i class="fas fa-shield-halved"></i></div> Fraud Detection
        </button>
      </div>
      <div class="nav-bottom">
        <div class="user-card">
          <div class="user-avatar" id="userAvatar">JD</div>
          <div><div class="user-name" id="userName">John Doe</div><div class="user-role" id="userRole">Admin</div></div>
        </div>
        <button class="logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
      </div>
    </nav>

    <!-- MAIN -->
    <div class="main-area">
      <!-- TOPBAR -->
      <div class="topbar">
        <button class="menu-btn" onclick="document.getElementById('sidebar').classList.toggle('open')"><i class="fas fa-bars"></i></button>
        <div class="topbar-title">InsureTrack <span>Pro</span></div>
        <div class="search-wrap">
          <i class="fas fa-search"></i>
          <input type="text" id="globalSearch" placeholder="Search policies, customers..." oninput="handleSearch(this.value)" onfocus="handleSearch(this.value)" autocomplete="off">
          <div class="search-dropdown" id="searchDropdown"></div>
        </div>
        <div class="notif-btn" onclick="showNotifications()"><i class="fas fa-bell"></i><span class="notif-badge" id="notifBadge">3</span></div>
        <button class="voice-btn" id="voiceBtn" onclick="toggleVoiceRecognition()"><i class="fas fa-microphone"></i></button>
      </div>

      <!-- PAGE CONTENT -->
      <div class="page-content">

        <!-- ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ -->
        <div id="dashboard" class="screen active">
          <div class="page-hd">
            <div class="page-hd-left">
              <div class="page-hd-icon" style="background:linear-gradient(135deg,rgba(59,130,246,.2),rgba(139,92,246,.15));color:var(--accent)"><i class="fas fa-chart-line"></i></div>
              <div><h2>Dashboard</h2><small>Real-time overview ¬∑ AI-powered</small></div>
            </div>
            <div class="page-hd-actions">
              <span class="ai-pill"><i class="fas fa-robot"></i> AI Active</span>
              <div class="export-menu">
                <button class="btn btn-ghost btn-sm"><i class="fas fa-download"></i> Export</button>
                <div class="export-dropdown">
                  <div class="export-item" onclick="exportToFormat('pdf')"><i class="fas fa-file-pdf" style="color:var(--rose)"></i> PDF Report</div>
                  <div class="export-item" onclick="exportToFormat('excel')"><i class="fas fa-file-excel" style="color:var(--teal)"></i> Excel Data</div>
                  <div class="export-item" onclick="exportToFormat('csv')"><i class="fas fa-file-csv" style="color:var(--accent)"></i> CSV Export</div>
                  <div class="export-item" onclick="exportToFormat('json')"><i class="fas fa-code" style="color:var(--violet)"></i> JSON Backup</div>
                </div>
              </div>
            </div>
          </div>

          <div class="ai-bar">
            <div class="ai-bar-icon"><i class="fas fa-lightbulb"></i></div>
            <div class="ai-bar-text" id="aiRecommendation"><strong>AI Insight:</strong> Add policies to receive personalised recommendations.</div>
          </div>

          <div class="actions-grid">
            <div class="action-card ac1" onclick="showScreen('policyEntry')">
              <div class="action-icon"><i class="fas fa-file-circle-plus"></i></div>
              <h5>Create Policy</h5><p>Add new insurance policy</p>
            </div>
            <div class="action-card ac2" onclick="showScreen('verification')">
              <div class="action-icon"><i class="fas fa-clipboard-check"></i></div>
              <h5>Verify Policies</h5><p>Review pending submissions</p>
            </div>
            <div class="action-card ac3" onclick="showScreen('aiInsights')">
              <div class="action-icon"><i class="fas fa-brain"></i></div>
              <h5>AI Insights</h5><p>Predictive analytics</p>
            </div>
            <div class="action-card ac4" onclick="openChat()">
              <div class="action-icon"><i class="fas fa-robot"></i></div>
              <h5>AI Assistant</h5><p>Chat with AI</p>
            </div>
          </div>

          <div class="stats-grid">
            <div class="stat total"><div class="stat-icon"><i class="fas fa-file-invoice"></i></div><div class="stat-num" id="totalPolicies">0</div><div class="stat-label">Total Policies</div><div class="stat-change up"><i class="fas fa-arrow-up"></i> 12% from last month</div></div>
            <div class="stat approved"><div class="stat-icon"><i class="fas fa-circle-check"></i></div><div class="stat-num" id="approvedPolicies">0</div><div class="stat-label">Approved</div><div class="stat-change up"><i class="fas fa-arrow-up"></i> 8% increase</div></div>
            <div class="stat rejected"><div class="stat-icon"><i class="fas fa-circle-xmark"></i></div><div class="stat-num" id="rejectedPolicies">0</div><div class="stat-label">Rejected</div><div class="stat-change down"><i class="fas fa-arrow-down"></i> 3% decrease</div></div>
            <div class="stat pending"><div class="stat-icon"><i class="fas fa-clock"></i></div><div class="stat-num" id="pendingPolicies">0</div><div class="stat-label">Pending</div><div class="stat-change" style="color:var(--muted)"><i class="fas fa-minus"></i> Stable</div></div>
          </div>

          <!-- CHARTS ROW 1 -->
          <div class="chart-grid-3">
            <div class="card">
              <div class="card-hd"><h3><i class="fas fa-chart-column"></i> Policy Types Breakdown</h3><button class="btn btn-ghost btn-sm" onclick="refreshCharts()"><i class="fas fa-arrows-rotate"></i></button></div>
              <div class="chart-box"><canvas id="barChart"></canvas></div>
            </div>
            <div class="card">
              <div class="card-hd"><h3><i class="fas fa-chart-pie"></i> Status Split</h3></div>
              <div class="chart-box"><canvas id="doughnutChart"></canvas></div>
            </div>
          </div>

          <!-- CHARTS ROW 2 -->
          <div class="chart-grid">
            <div class="card">
              <div class="card-hd"><h3><i class="fas fa-chart-line"></i> Monthly Revenue Trend</h3></div>
              <div class="chart-box" style="height:220px"><canvas id="lineChart"></canvas></div>
            </div>
            <div class="card">
              <div class="card-hd"><h3><i class="fas fa-shield-halved"></i> Risk Distribution</h3></div>
              <div class="chart-box" style="height:220px"><canvas id="riskChart"></canvas></div>
            </div>
          </div>

          <!-- Progress + Activity -->
          <div style="display:grid;grid-template-columns:2fr 1fr;gap:24px">
            <div class="card">
              <div class="card-hd"><h3><i class="fas fa-table-list"></i> Recent Policies</h3><button class="btn btn-ghost btn-sm" onclick="showScreen('verification')">View All</button></div>
              <div class="table-wrap">
                <table>
                  <thead><tr><th>Policy #</th><th>Type</th><th>Customer</th><th>Premium</th><th>Date</th><th>Status</th><th>Risk</th></tr></thead>
                  <tbody id="dashboardTable"><tr><td colspan="7" style="text-align:center;color:var(--muted);padding:32px">No policies yet ‚Äî create your first one!</td></tr></tbody>
                </table>
              </div>
              <div style="margin-top:20px">
                <div style="display:flex;justify-content:space-between;margin-bottom:8px"><span style="font-size:13px;color:var(--muted);font-weight:600">AI-Predicted Approval Rate</span><span style="font-size:13px;font-weight:700;color:var(--accent)" id="progressPercent">0%</span></div>
                <div class="progress-bar-wrap"><div class="progress-bar-fill" id="progressBar" style="width:0%"></div></div>
              </div>
            </div>
            <div class="card">
              <div class="card-hd"><h3><i class="fas fa-clock-rotate-left"></i> Activity</h3></div>
              <div class="timeline" id="activityTimeline" style="max-height:360px;overflow-y:auto"><p style="color:var(--muted);font-size:14px;text-align:center">No activity yet</p></div>
            </div>
          </div>
        </div>

        <!-- ‚îÄ‚îÄ POLICY ENTRY ‚îÄ‚îÄ -->
        <div id="policyEntry" class="screen">
          <div class="page-hd">
            <div class="page-hd-left">
              <div class="page-hd-icon" style="background:rgba(20,184,166,.15);color:var(--teal)"><i class="fas fa-file-circle-plus"></i></div>
              <div><h2>Create New Policy</h2><small>AI-assisted with smart risk scoring</small></div>
            </div>
            <div class="page-hd-actions">
              <button class="btn btn-gold btn-sm" onclick="autofillDemo()"><i class="fas fa-wand-magic-sparkles"></i> Demo Data</button>
              <button class="btn btn-ghost btn-sm" onclick="getAISuggestions()"><i class="fas fa-lightbulb"></i> AI Tips</button>
            </div>
          </div>
          <div id="policySuccessAlert" class="alert alert-success" style="display:none"><i class="fas fa-check-circle"></i> Policy submitted and analysed by AI successfully!</div>
          <div class="card">
            <form id="policyForm" onsubmit="handlePolicySubmit(event)">
              <div style="margin-bottom:28px">
                <div style="font-family:'Poppins',sans-serif;font-size:14px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:1.2px;margin-bottom:18px;display:flex;align-items:center;gap:10px"><i class="fas fa-info-circle" style="color:var(--accent)"></i> Basic Information</div>
                <div class="form-row">
                  <div class="form-group"><label><i class="fas fa-barcode"></i> Policy Number</label><input type="text" class="form-control" id="policyNumber" placeholder="POL-2024-XXXX" required></div>
                  <div class="form-group"><label><i class="fas fa-layer-group"></i> Policy Type</label>
                    <select class="form-select" id="policyType" required onchange="updateRiskAssessment()">
                      <option value="">Select type‚Ä¶</option>
                      <option value="Life Insurance">üíº Life Insurance</option>
                      <option value="Health Insurance">üè• Health Insurance</option>
                      <option value="Auto Insurance">üöó Auto Insurance</option>
                      <option value="Home Insurance">üè† Home Insurance</option>
                      <option value="Business Insurance">üè¢ Business Insurance</option>
                      <option value="Travel Insurance">‚úàÔ∏è Travel Insurance</option>
                    </select>
                  </div>
                </div>
              </div>
              <div style="margin-bottom:28px">
                <div style="font-family:'Poppins',sans-serif;font-size:14px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:1.2px;margin-bottom:18px;display:flex;align-items:center;gap:10px"><i class="fas fa-user-circle" style="color:var(--violet)"></i> Customer Details</div>
                <div class="form-row">
                  <div class="form-group"><label><i class="fas fa-user"></i> Full Name</label><input type="text" class="form-control" id="customerName" placeholder="Jane Smith" required></div>
                  <div class="form-group"><label><i class="fas fa-envelope"></i> Email</label><input type="email" class="form-control" id="customerEmail" placeholder="jane@example.com" required></div>
                </div>
                <div class="form-row">
                  <div class="form-group"><label><i class="fas fa-phone"></i> Contact</label><input type="tel" class="form-control" id="contactNumber" placeholder="+1 234 567 8900" required></div>
                  <div class="form-group"><label><i class="fas fa-location-dot"></i> Address</label><input type="text" class="form-control" id="customerAddress" placeholder="123 Main St, City"></div>
                </div>
              </div>
              <div style="margin-bottom:28px">
                <div style="font-family:'Poppins',sans-serif;font-size:14px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:1.2px;margin-bottom:18px;display:flex;align-items:center;gap:10px"><i class="fas fa-file-invoice-dollar" style="color:var(--amber)"></i> Policy Details</div>
                <div class="form-row-3">
                  <div class="form-group"><label><i class="fas fa-dollar-sign"></i> Premium ($)</label><input type="number" class="form-control" id="premiumAmount" placeholder="1000" required onchange="updateRiskAssessment()"></div>
                  <div class="form-group"><label><i class="fas fa-calendar-days"></i> Start Date</label><input type="date" class="form-control" id="startDate" required></div>
                  <div class="form-group"><label><i class="fas fa-calendar-check"></i> End Date</label><input type="date" class="form-control" id="endDate" required></div>
                </div>
                <div class="form-row">
                  <div class="form-group"><label><i class="fas fa-repeat"></i> Payment Freq.</label>
                    <select class="form-select" id="paymentFrequency"><option>Monthly</option><option>Quarterly</option><option>Semi-Annual</option><option>Annual</option></select>
                  </div>
                  <div class="form-group"><label><i class="fas fa-shield"></i> Coverage ($)</label><input type="number" class="form-control" id="coverageAmount" placeholder="50000"></div>
                </div>
              </div>
              <div class="insight-block" style="margin-bottom:24px">
                <h6><i class="fas fa-shield-halved"></i> AI Risk Assessment</h6>
                <div class="risk-bar"><div class="risk-fill" id="riskMeter" style="width:25%"></div></div>
                <div style="display:flex;justify-content:space-between;font-size:13px;color:var(--muted);margin-top:8px"><span>Low Risk</span><span>High Risk</span></div>
                <div style="margin-top:10px;font-size:14px">Risk Level: <strong id="riskLevel" style="color:var(--teal)">Low</strong> ‚Äî <span id="riskDetails" style="color:var(--text2)">Standard processing recommended</span></div>
              </div>
              <div class="form-group"><label><i class="fas fa-note-sticky"></i> Notes</label><textarea class="form-control" id="notes" placeholder="Additional information‚Ä¶"></textarea></div>
              <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:10px">
                <button type="submit" class="btn btn-primary"><i class="fas fa-paper-plane"></i> Submit Policy</button>
                <button type="reset" class="btn btn-ghost" onclick="updateRiskAssessment()"><i class="fas fa-rotate-left"></i> Reset</button>
              </div>
            </form>
          </div>
        </div>

        <!-- ‚îÄ‚îÄ VERIFICATION ‚îÄ‚îÄ -->
        <div id="verification" class="screen">
          <div class="page-hd">
            <div class="page-hd-left">
              <div class="page-hd-icon" style="background:rgba(20,184,166,.15);color:var(--teal)"><i class="fas fa-clipboard-check"></i></div>
              <div><h2>Policy Verification</h2><small>AI-powered quality control</small></div>
            </div>
            <div class="page-hd-actions">
              <button class="btn btn-ghost btn-sm" onclick="loadVerificationTable()"><i class="fas fa-arrows-rotate"></i> Refresh</button>
              <button class="btn btn-primary btn-sm" onclick="runAIBatchVerification()"><i class="fas fa-robot"></i> AI Batch Verify</button>
            </div>
          </div>
          <div class="ai-bar" style="margin-bottom:20px"><div class="ai-bar-icon" style="background:linear-gradient(135deg,#14b8a6,#0d9488)"><i class="fas fa-brain"></i></div><div class="ai-bar-text" id="verificationStatus">Ready to verify policies ‚Äî use filters or AI Batch Verify below.</div></div>
          <div class="filter-bar">
            <span class="filter-label">Filters:</span>
            <input type="text" id="verifySearch" placeholder="Search by name or policy #‚Ä¶" oninput="applyFilters()">
            <select class="form-select" id="filterStatus" onchange="applyFilters()"><option value="all">All Status</option><option value="Pending">Pending</option><option value="Approved">Approved</option><option value="Rejected">Rejected</option></select>
            <select class="form-select" id="filterType" onchange="applyFilters()"><option value="all">All Types</option><option value="Life Insurance">Life</option><option value="Health Insurance">Health</option><option value="Auto Insurance">Auto</option><option value="Home Insurance">Home</option><option value="Business Insurance">Business</option><option value="Travel Insurance">Travel</option></select>
            <select class="form-select" id="filterRisk" onchange="applyFilters()"><option value="all">All Risks</option><option value="Low">Low</option><option value="Medium">Medium</option><option value="High">High</option></select>
            <button class="btn btn-ghost btn-sm" onclick="resetFilters()"><i class="fas fa-times"></i> Clear</button>
          </div>
          <div class="card" style="padding:0">
            <div class="table-wrap">
              <table>
                <thead><tr><th>Policy #</th><th>Type</th><th>Customer</th><th>Premium</th><th>Risk</th><th>Status</th><th>Date</th><th>Actions</th></tr></thead>
                <tbody id="verificationTable"><tr><td colspan="8" style="text-align:center;color:var(--muted);padding:32px">No policies found</td></tr></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- ‚îÄ‚îÄ AI INSIGHTS ‚îÄ‚îÄ -->
        <div id="aiInsights" class="screen">
          <div class="page-hd">
            <div class="page-hd-left">
              <div class="page-hd-icon" style="background:rgba(139,92,246,.15);color:var(--violet)"><i class="fas fa-brain"></i></div>
              <div><h2>AI Insights</h2><small>Predictive analytics</small></div>
            </div>
            <div class="page-hd-actions">
              <button class="btn btn-primary btn-sm" onclick="generateAIInsights()"><i class="fas fa-sparkles"></i> Regenerate</button>
            </div>
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-bottom:24px">
            <div class="card">
              <div class="card-hd"><h3><i class="fas fa-chart-line"></i> Predictive Trends</h3></div>
              <div class="insight-block"><h6><i class="fas fa-arrow-trend-up"></i> Growth Prediction</h6><ul><li>15% increase expected next quarter</li><li>Health insurance showing highest growth</li><li>Peak season in Q3</li></ul></div>
              <div class="insight-block"><h6><i class="fas fa-triangle-exclamation"></i> Risk Alerts</h6><ul><li>High-risk policies require manual review</li><li>Unusual claim patterns detected</li><li>Premium adjustments recommended for Auto</li></ul></div>
            </div>
            <div class="card">
              <div class="card-hd"><h3><i class="fas fa-lightbulb"></i> Recommendations</h3></div>
              <div class="insight-block"><h6><i class="fas fa-star"></i> Top Suggestions</h6><ol><li>Focus health insurance marketing spend</li><li>Review pricing for high-risk policies</li><li>Fast-track approval for low-risk cases</li><li>Bundle offers for Q3 campaigns</li></ol></div>
              <div class="insight-block"><h6><i class="fas fa-users"></i> Customer Insights</h6><ul><li>Average customer age: 35‚Äì45 years</li><li>Preferred payment: Annual (62%)</li><li>Satisfaction score: 4.5 / 5</li><li>Renewal rate: 78%</li></ul></div>
            </div>
          </div>
          <div class="card">
            <div class="card-hd"><h3><i class="fas fa-chart-area"></i> Policy Type Comparison (Radar)</h3></div>
            <div style="height:320px;display:flex;justify-content:center"><canvas id="radarChart" style="max-width:440px"></canvas></div>
          </div>
        </div>

        <!-- ‚îÄ‚îÄ REPORTS ‚îÄ‚îÄ -->
        <div id="reports" class="screen">
          <div class="page-hd">
            <div class="page-hd-left">
              <div class="page-hd-icon" style="background:rgba(245,158,11,.15);color:var(--amber)"><i class="fas fa-chart-bar"></i></div>
              <div><h2>Reports & Analytics</h2><small>Comprehensive performance insights</small></div>
            </div>
            <div class="page-hd-actions">
              <button class="btn btn-success btn-sm" onclick="scheduleEmailReport()"><i class="fas fa-envelope"></i> Schedule</button>
              <div class="export-menu">
                <button class="btn btn-primary btn-sm"><i class="fas fa-download"></i> Export</button>
                <div class="export-dropdown">
                  <div class="export-item" onclick="exportReport('pdf')"><i class="fas fa-file-pdf"></i> PDF</div>
                  <div class="export-item" onclick="exportReport('excel')"><i class="fas fa-file-excel"></i> Excel</div>
                  <div class="export-item" onclick="exportReport('csv')"><i class="fas fa-file-csv"></i> CSV</div>
                </div>
              </div>
            </div>
          </div>
          <div class="metric-trio">
            <div class="metric-box"><div class="metric-val" id="totalRevenue">$0</div><div class="metric-label">Total Revenue</div></div>
            <div class="metric-box"><div class="metric-val" id="avgPremium">$0</div><div class="metric-label">Average Premium</div></div>
            <div class="metric-box"><div class="metric-val" id="approvalRate">0%</div><div class="metric-label">Approval Rate</div></div>
          </div>
          <div class="card" style="margin-bottom:24px">
            <div class="card-hd"><h3><i class="fas fa-chart-line"></i> Monthly Performance</h3></div>
            <div class="chart-box" style="height:280px"><canvas id="reportsLineChart"></canvas></div>
          </div>
          <div class="card">
            <div class="card-hd"><h3><i class="fas fa-table"></i> Detailed Analytics</h3></div>
            <div class="table-wrap">
              <table>
                <thead><tr><th>Month</th><th>Total</th><th>Approved</th><th>Rejected</th><th>Revenue</th><th>Growth</th></tr></thead>
                <tbody id="reportTable"><tr><td colspan="6" style="text-align:center;color:var(--muted);padding:28px">Loading‚Ä¶</td></tr></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- ‚îÄ‚îÄ ADMIN (Team) ‚îÄ‚îÄ -->
        <div id="admin" class="screen">
          <div class="page-hd">
            <div class="page-hd-left">
              <div class="page-hd-icon" style="background:rgba(244,63,94,.15);color:var(--rose)"><i class="fas fa-users-gear"></i></div>
              <div><h2>Team Management</h2><small>Manage members and permissions</small></div>
            </div>
            <div class="page-hd-actions">
              <div class="collab-badge" style="position:relative;top:0;right:0">3</div>
              <span style="color:var(--muted);font-weight:600">Active now</span>
            </div>
          </div>
          <div style="display:grid;grid-template-columns:1fr 1.6fr;gap:24px">
            <div class="card">
              <div class="card-hd"><h3><i class="fas fa-user-plus"></i> Add Member</h3></div>
              <div id="employeeSuccessAlert" class="alert alert-success" style="display:none"><i class="fas fa-check-circle"></i> Team member added!</div>
              <form onsubmit="handleEmployeeSubmit(event)">
                <div class="form-group"><label><i class="fas fa-id-card"></i> Full Name</label><input type="text" class="form-control" id="empName" required></div>
                <div class="form-group"><label><i class="fas fa-envelope"></i> Email</label><input type="email" class="form-control" id="empEmail" required></div>
                <div class="form-group"><label><i class="fas fa-phone"></i> Phone</label><input type="tel" class="form-control" id="empPhone"></div>
                <div class="form-group"><label><i class="fas fa-user-tag"></i> Role</label>
                  <select class="form-select" id="empRole" required><option value="">Select role‚Ä¶</option><option value="Agent">Agent</option><option value="Verifier">Verifier</option><option value="Manager">Manager</option><option value="Admin">Admin</option></select>
                </div>
                <div class="form-group"><label><i class="fas fa-building"></i> Department</label><input type="text" class="form-control" id="empDept" required></div>
                <button type="submit" class="btn btn-primary" style="width:100%;justify-content:center"><i class="fas fa-user-plus"></i> Add Member</button>
              </form>
            </div>
            <div class="card" style="padding:0">
              <div style="padding:24px 28px 0"><div class="card-hd" style="margin-bottom:18px"><h3><i class="fas fa-users"></i> Team Members</h3></div></div>
              <div class="table-wrap" style="border:none;border-radius:0">
                <table>
                  <thead><tr><th>Name</th><th>Email</th><th>Role</th><th>Department</th></tr></thead>
                  <tbody id="employeeTable"><tr><td colspan="4" style="text-align:center;color:var(--muted);padding:32px">No team members yet</td></tr></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- ‚îÄ‚îÄ SETTINGS ‚îÄ‚îÄ -->
        <div id="settings" class="screen">
          <div class="page-hd">
            <div class="page-hd-left">
              <div class="page-hd-icon" style="background:rgba(139,92,246,.15);color:var(--violet)"><i class="fas fa-cog"></i></div>
              <div><h2>Settings</h2><small>Configure preferences</small></div>
            </div>
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:24px">
            <div>
              <div class="card" style="margin-bottom:24px">
                <div class="card-hd"><h3><i class="fas fa-robot"></i> AI Configuration</h3></div>
                <div class="alert alert-info"><i class="fas fa-info-circle"></i> AI features are pre-configured and active.</div>
                <label style="display:flex;align-items:center;gap:12px;padding:14px 0;border-bottom:1px solid var(--border);cursor:pointer"><input type="checkbox" checked style="width:18px;height:18px;accent-color:var(--accent)"><span style="font-size:14px">Enable AI Assistance</span></label>
                <label style="display:flex;align-items:center;gap:12px;padding:14px 0;border-bottom:1px solid var(--border);cursor:pointer"><input type="checkbox" checked style="width:18px;height:18px;accent-color:var(--accent)"><span style="font-size:14px">AI Auto-Verify Low Risk</span></label>
                <label style="display:flex;align-items:center;gap:12px;padding:14px 0;cursor:pointer"><input type="checkbox" checked style="width:18px;height:18px;accent-color:var(--accent)"><span style="font-size:14px">Show AI Recommendations</span></label>
              </div>
              <div class="card">
                <div class="card-hd"><h3><i class="fas fa-user-gear"></i> Profile</h3></div>
                <div class="form-group"><label>Display Name</label><input type="text" class="form-control" value="John Doe"></div>
                <div class="form-group"><label>Email</label><input type="email" class="form-control" value="john@example.com"></div>
                <button class="btn btn-primary btn-sm"><i class="fas fa-save"></i> Save Changes</button>
              </div>
            </div>
            <div>
              <div class="card" style="margin-bottom:24px">
                <div class="card-hd"><h3><i class="fas fa-bell"></i> Notifications</h3></div>
                <label style="display:flex;align-items:center;gap:12px;padding:14px 0;border-bottom:1px solid var(--border);cursor:pointer"><input type="checkbox" checked style="width:18px;height:18px;accent-color:var(--accent)"><span style="font-size:14px">Email Notifications</span></label>
                <label style="display:flex;align-items:center;gap:12px;padding:14px 0;border-bottom:1px solid var(--border);cursor:pointer"><input type="checkbox" checked style="width:18px;height:18px;accent-color:var(--accent)"><span style="font-size:14px">Push Notifications</span></label>
                <label style="display:flex;align-items:center;gap:12px;padding:14px 0;cursor:pointer"><input type="checkbox" checked style="width:18px;height:18px;accent-color:var(--accent)"><span style="font-size:14px">AI Risk Alerts</span></label>
              </div>
              <div class="card">
                <div class="card-hd"><h3><i class="fas fa-database"></i> Data Management</h3></div>
                <button class="btn btn-success" style="width:100%;justify-content:center;margin-bottom:12px" onclick="exportAllData()"><i class="fas fa-download"></i> Export All Data</button>
                <button class="btn btn-gold" style="width:100%;justify-content:center;margin-bottom:12px" onclick="backupData()"><i class="fas fa-cloud-arrow-up"></i> Backup Data</button>
                <button class="btn btn-danger" style="width:100%;justify-content:center" onclick="confirmClearData()"><i class="fas fa-trash"></i> Clear All Data</button>
              </div>
            </div>
          </div>
        </div>

        <!-- ‚îÄ‚îÄ ADVANCED ANALYTICS ‚îÄ‚îÄ -->
        <div id="advancedAnalytics" class="screen">
          <div class="page-hd">
            <div class="page-hd-left">
              <div class="page-hd-icon" style="background:rgba(59,130,246,.15);color:var(--accent)"><i class="fas fa-chart-simple"></i></div>
              <div><h2>Advanced Analytics</h2><small>ML-powered forecasting & insights</small></div>
            </div>
            <div class="page-hd-actions">
              <button class="btn btn-primary btn-sm" onclick="runMLForecast()"><i class="fas fa-chart-line"></i> Run ML Forecast</button>
            </div>
          </div>
          <div class="card" style="margin-bottom:24px">
            <div class="card-hd"><h3><i class="fas fa-chart-line"></i> 30-Day Policy Forecast</h3></div>
            <div id="forecastChart" class="apex-chart"></div>
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:24px">
            <div class="card">
              <div class="card-hd"><h3><i class="fas fa-calendar-alt"></i> Activity Heatmap</h3></div>
              <div id="heatmap" class="calendar-heatmap"></div>
            </div>
            <div class="card">
              <div class="card-hd"><h3><i class="fas fa-chart-pie"></i> Customer Segments</h3></div>
              <div class="chart-box" style="height:220px"><canvas id="segmentChart"></canvas></div>
            </div>
          </div>
        </div>

        <!-- ‚îÄ‚îÄ FRAUD DETECTION ‚îÄ‚îÄ -->
        <div id="fraudDetection" class="screen">
          <div class="page-hd">
            <div class="page-hd-left">
              <div class="page-hd-icon" style="background:rgba(244,63,94,.15);color:var(--rose)"><i class="fas fa-shield-halved"></i></div>
              <div><h2>Fraud Detection</h2><small>Real-time anomaly monitoring</small></div>
            </div>
            <div class="page-hd-actions">
              <button class="btn btn-danger btn-sm" onclick="scanForFraud()"><i class="fas fa-search"></i> Full Scan</button>
            </div>
          </div>
          <div class="alert alert-warning" id="fraudAlert" style="display:none"><i class="fas fa-exclamation-triangle"></i> Suspicious activity detected</div>
          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:24px">
            <div class="card">
              <div class="metric-val" style="font-size:32px" id="fraudScore">0</div>
              <div class="metric-label">Fraud Risk Score</div>
              <div class="progress-bar-wrap" style="margin-top:12px"><div class="progress-bar-fill" id="fraudMeter" style="width:0%;background:linear-gradient(90deg,#f43f5e,#f59e0b)"></div></div>
            </div>
            <div class="card">
              <div class="metric-val" style="font-size:32px" id="flaggedPolicies">0</div>
              <div class="metric-label">Flagged Policies</div>
            </div>
            <div class="card">
              <div class="metric-val" style="font-size:32px" id="falsePositives">0</div>
              <div class="metric-label">False Positives</div>
            </div>
          </div>
          <div class="card">
            <div class="card-hd"><h3><i class="fas fa-flag"></i> Suspicious Policies</h3></div>
            <div class="table-wrap">
              <table>
                <thead><tr><th>Policy #</th><th>Customer</th><th>Amount</th><th>Anomaly Score</th><th>Reason</th><th>Action</th></tr></thead>
                <tbody id="fraudTable"><tr><td colspan="6" style="text-align:center;color:var(--muted);padding:32px">No suspicious policies found</td></tr></tbody>
              </table>
            </div>
          </div>
        </div>

      </div><!-- /page-content -->
    </div><!-- /main-area -->
  </div><!-- /app-wrap -->
</div><!-- /app -->

<!-- ‚ïê‚ïê‚ïê CHATBOT ‚ïê‚ïê‚ïê -->
<div class="chatbot-wrap">
  <button class="chat-toggle" onclick="toggleChat()"><i class="fas fa-robot"></i></button>
  <div class="chat-window" id="chatWindow">
    <div class="chat-hd">
      <div class="chat-hd-left"><div class="chat-hd-avatar"><i class="fas fa-robot"></i></div><div><h5>AI Assistant</h5></div></div>
      <button class="chat-close" onclick="toggleChat()"><i class="fas fa-times"></i></button>
    </div>
    <div class="chat-messages" id="chatMessages">
      <div class="msg bot"><div class="msg-av bot"><i class="fas fa-robot"></i></div><div class="msg-bubble">Hello! I'm your AI insurance assistant. How can I help you today? üõ°Ô∏è</div></div>
    </div>
    <div class="chat-input-wrap">
      <input type="text" id="chatInput" placeholder="Ask me anything‚Ä¶" onkeypress="if(event.key==='Enter')sendChat()">
      <button class="chat-send" onclick="sendChat()"><i class="fas fa-paper-plane"></i></button>
    </div>
  </div>
</div>

<script>
// ‚ïê‚ïê CONFIG ‚ïê‚ïê
// API Keys from environment variables (Vercel will inject these)
const GEMINI_KEY = '%%GEMINI_API_KEY%%'; // This will be replaced by Vercel

// ‚ïê‚ïê GLOBAL STATE ‚ïê‚ïê
let activities = [];
let charts = {};
let currentFilters = { status: 'all', type: 'all', risk: 'all', search: '' };
let isListening = false;
let recognition = null;
let forecastChart = null;

// ‚ïê‚ïê STORAGE HELPERS ‚ïê‚ïê
const getP = () => JSON.parse(localStorage.getItem('policies') || '[]');
const setP = (data) => localStorage.setItem('policies', JSON.stringify(data));
const getE = () => JSON.parse(localStorage.getItem('employees') || '[]');
const setE = (data) => localStorage.setItem('employees', JSON.stringify(data));

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// GEMINI AI INTEGRATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function callGemini(prompt) {
  try {
    // If API key is not set, return mock response
    if (!GEMINI_KEY || GEMINI_KEY === '%%GEMINI_API_KEY%%') {
      console.log('Using mock AI response (API key not configured)');
      return getMockAIResponse(prompt);
    }
    
    const response = await fetch(
      `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${GEMINI_KEY}`,
      {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          contents: [{
            parts: [{ text: prompt }]
          }]
        })
      }
    );
    
    if (!response.ok) {
      throw new Error('API request failed');
    }
    
    const data = await response.json();
    return data.candidates?.[0]?.content?.parts?.[0]?.text || 'AI analysis complete.';
  } catch (error) {
    console.error('Gemini API Error:', error);
    return getMockAIResponse(prompt);
  }
}

// Mock AI responses for when API key is not configured
function getMockAIResponse(prompt) {
  if (prompt.includes('recommendation')) {
    return "Focus on high-value policies and consider seasonal trends for better approval rates.";
  }
  if (prompt.includes('insurance assistant')) {
    return "I can help you with policy creation, risk assessment, and fraud detection. What would you like to know?";
  }
  if (prompt.includes('suggestions')) {
    return "‚Ä¢ Review policy details carefully\n‚Ä¢ Check customer history\n‚Ä¢ Verify documentation\n‚Ä¢ Assess risk factors";
  }
  return "AI analysis complete. Based on your data, standard processing is recommended.";
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AUTHENTICATION & USER MANAGEMENT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function handleLogin(event) {
  event.preventDefault();
  
  const username = document.getElementById('username').value;
  const role = document.getElementById('role').value;
  const initials = username.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
  
  localStorage.setItem('currentUser', JSON.stringify({ username, role, initials }));
  
  document.getElementById('userName').textContent = username;
  document.getElementById('userRole').textContent = role;
  document.getElementById('userAvatar').textContent = initials;
  
  document.getElementById('loginScreen').style.display = 'none';
  document.getElementById('app').style.display = 'block';
  
  showScreen('dashboard');
}

function logout() {
  if (!confirm('Are you sure you want to log out?')) return;
  
  localStorage.removeItem('currentUser');
  document.getElementById('app').style.display = 'none';
  document.getElementById('loginScreen').style.display = 'block';
  document.querySelector('form').reset();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAVIGATION & SCREEN MANAGEMENT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showScreen(screenName, buttonElement) {
  // Hide all screens
  document.querySelectorAll('.page-content .screen').forEach(screen => {
    screen.classList.remove('active');
  });
  
  // Remove active state from all nav items
  document.querySelectorAll('.nav-item').forEach(navItem => {
    navItem.classList.remove('active');
  });
  
  // Show selected screen
  const targetScreen = document.getElementById(screenName);
  if (targetScreen) targetScreen.classList.add('active');
  
  // Add active state to nav button
  if (buttonElement) {
    buttonElement.classList.add('active');
  } else {
    const navButton = document.querySelector(`.nav-item[data-screen="${screenName}"]`);
    if (navButton) navButton.classList.add('active');
  }
  
  // Load screen-specific data
  if (screenName === 'dashboard') updateDashboard();
  if (screenName === 'verification') loadVerificationTable();
  if (screenName === 'admin') loadEmployeeTable();
  if (screenName === 'reports') loadReports();
  if (screenName === 'aiInsights') initRadarChart();
  if (screenName === 'advancedAnalytics') initAdvancedAnalytics();
  if (screenName === 'fraudDetection') updateFraudDetection();
  
  // Close sidebar on mobile
  if (window.innerWidth < 900) {
    document.getElementById('sidebar').classList.remove('open');
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// GLOBAL SEARCH
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function handleSearch(value) {
  const dropdown = document.getElementById('searchDropdown');
  const searchValue = value.trim().toLowerCase();
  
  if (!searchValue) {
    dropdown.classList.remove('show');
    return;
  }
  
  const policies = getP();
  const results = policies.filter(policy =>
    policy.policyNumber?.toLowerCase().includes(searchValue) ||
    policy.customerName?.toLowerCase().includes(searchValue) ||
    policy.policyType?.toLowerCase().includes(searchValue) ||
    policy.customerEmail?.toLowerCase().includes(searchValue)
  ).slice(0, 6);
  
  if (!results.length) {
    dropdown.innerHTML = `
      <div style="padding:16px 14px;text-align:center;color:var(--muted);font-size:14px">
        No results found
      </div>
    `;
  } else {
    const icons = {
      'Life Insurance': 'fa-heart-pulse',
      'Health Insurance': 'fa-hospital',
      'Auto Insurance': 'fa-car',
      'Home Insurance': 'fa-house',
      'Business Insurance': 'fa-building',
      'Travel Insurance': 'fa-plane'
    };
    
    const colors = {
      'Low': 'var(--teal)',
      'Medium': 'var(--amber)',
      'High': 'var(--rose)'
    };
    
    dropdown.innerHTML = results.map(policy => `
      <div class="search-result-item" onclick="openPolicyDetail('${policy.id}')">
        <div class="search-result-icon" style="background:rgba(59,130,246,.15);color:var(--accent)">
          <i class="fas ${icons[policy.policyType] || 'fa-file'}"></i>
        </div>
        <div>
          <div class="search-result-title">${policy.policyNumber} ‚Äî ${policy.customerName}</div>
          <div class="search-result-sub">
            ${policy.policyType} ¬∑ $${policy.premiumAmount?.toLocaleString()} ¬∑ 
            <span style="color:${colors[policy.riskLevel] || 'var(--muted)'}">${policy.status}</span>
          </div>
        </div>
      </div>
    `).join('');
  }
  
  dropdown.classList.add('show');
}

function openPolicyDetail(policyId) {
  document.getElementById('searchDropdown').classList.remove('show');
  document.getElementById('globalSearch').value = '';
  showScreen('verification');
}

// Close dropdown when clicking outside
document.addEventListener('click', (event) => {
  if (!event.target.closest('.search-wrap')) {
    document.getElementById('searchDropdown').classList.remove('show');
  }
  
  if (window.innerWidth < 900 && !event.target.closest('.sidebar') && !event.target.closest('.menu-btn')) {
    document.getElementById('sidebar').classList.remove('open');
  }
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NOTIFICATIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateNotifBadge(delta = 1) {
  const badge = document.getElementById('notifBadge');
  const currentCount = parseInt(badge.textContent || 0);
  badge.textContent = currentCount + delta;
}

function showNotifications() {
  document.getElementById('notifBadge').textContent = '0';
  alert('No new notifications.');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RISK ASSESSMENT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateRiskAssessment() {
  const policyType = document.getElementById('policyType').value;
  const premiumAmount = parseFloat(document.getElementById('premiumAmount').value) || 0;
  
  let riskScore = 20;
  
  // Type-based risk
  if (['Life Insurance', 'Health Insurance'].includes(policyType)) {
    riskScore += 20;
  }
  if (policyType === 'Business Insurance') {
    riskScore += 15;
  }
  
  // Premium-based risk
  if (premiumAmount > 5000) {
    riskScore += 30;
  } else if (premiumAmount > 2000) {
    riskScore += 15;
  }
  
  riskScore = Math.min(riskScore, 95);
  
  const riskLevel = riskScore > 60 ? 'High' : riskScore > 40 ? 'Medium' : 'Low';
  const riskDetails = riskLevel === 'High' 
    ? 'Additional verification required' 
    : riskLevel === 'Medium' 
    ? 'Standard verification process' 
    : 'Standard processing recommended';
  
  const colors = {
    Low: 'var(--teal)',
    Medium: 'var(--amber)',
    High: 'var(--rose)'
  };
  
  document.getElementById('riskMeter').style.width = riskScore + '%';
  document.getElementById('riskLevel').textContent = riskLevel;
  document.getElementById('riskLevel').style.color = colors[riskLevel];
  document.getElementById('riskDetails').textContent = riskDetails;
  
  return riskLevel;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DEMO DATA AUTOFILL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function autofillDemo() {
  const names = ['Sarah Johnson', 'Michael Chen', 'Emma Williams', 'James Rodriguez', 'Olivia Park'];
  const types = ['Life Insurance', 'Health Insurance', 'Auto Insurance', 'Home Insurance', 'Travel Insurance'];
  
  const randomName = names[Math.floor(Math.random() * names.length)];
  const randomType = types[Math.floor(Math.random() * types.length)];
  
  document.getElementById('policyNumber').value = 'POL-2024-' + Math.floor(Math.random() * 9000 + 1000);
  document.getElementById('policyType').value = randomType;
  document.getElementById('customerName').value = randomName;
  document.getElementById('customerEmail').value = randomName.toLowerCase().replace(' ', '.') + '@example.com';
  document.getElementById('contactNumber').value = '+1 ' + Math.floor(Math.random() * 9000000000 + 1000000000);
  document.getElementById('premiumAmount').value = Math.floor(Math.random() * 4500 + 500);
  document.getElementById('customerAddress').value = Math.floor(Math.random() * 999 + 1) + ' Main St, New York';
  document.getElementById('coverageAmount').value = Math.floor(Math.random() * 90000 + 10000);
  
  const today = new Date();
  const endDate = new Date();
  endDate.setFullYear(endDate.getFullYear() + 1);
  
  document.getElementById('startDate').value = today.toISOString().split('T')[0];
  document.getElementById('endDate').value = endDate.toISOString().split('T')[0];
  
  updateRiskAssessment();
}

async function getAISuggestions() {
  const policyType = document.getElementById('policyType').value;
  
  if (!policyType) {
    alert('Please select a policy type first!');
    return;
  }
  
  const suggestions = await callGemini(
    `Give 3 short, practical suggestions for creating a ${policyType} policy in bullet points.`
  );
  
  alert('AI Suggestions:\n\n' + suggestions);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// POLICY MANAGEMENT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function handlePolicySubmit(event) {
  event.preventDefault();
  
  const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
  
  const policy = {
    id: 'POL' + Date.now(),
    policyNumber: document.getElementById('policyNumber').value,
    policyType: document.getElementById('policyType').value,
    customerName: document.getElementById('customerName').value,
    customerEmail: document.getElementById('customerEmail').value,
    contactNumber: document.getElementById('contactNumber').value,
    customerAddress: document.getElementById('customerAddress').value,
    premiumAmount: parseFloat(document.getElementById('premiumAmount').value),
    startDate: document.getElementById('startDate').value,
    endDate: document.getElementById('endDate').value,
    paymentFrequency: document.getElementById('paymentFrequency').value,
    coverageAmount: document.getElementById('coverageAmount').value,
    notes: document.getElementById('notes').value,
    status: 'Pending',
    riskLevel: document.getElementById('riskLevel').textContent,
    submittedDate: new Date().toLocaleDateString(),
    submittedBy: currentUser.username || 'System',
    fraudScore: Math.random() * 100
  };
  
  const policies = getP();
  policies.push(policy);
  setP(policies);
  
  const alertElement = document.getElementById('policySuccessAlert');
  alertElement.style.display = 'flex';
  setTimeout(() => alertElement.style.display = 'none', 3500);
  
  document.getElementById('policyForm').reset();
  updateRiskAssessment();
  
  addActivity('Policy created', policy.policyNumber, 'info');
  updateNotifBadge(1);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// POLICY VERIFICATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function loadVerificationTable() {
  const policies = getP();
  const searchQuery = (document.getElementById('verifySearch')?.value || '').toLowerCase();
  
  const filteredPolicies = policies.filter(policy => {
    if (currentFilters.status !== 'all' && policy.status !== currentFilters.status) return false;
    if (currentFilters.type !== 'all' && policy.policyType !== currentFilters.type) return false;
    if (currentFilters.risk !== 'all' && policy.riskLevel !== currentFilters.risk) return false;
    if (searchQuery && 
        !policy.policyNumber?.toLowerCase().includes(searchQuery) && 
        !policy.customerName?.toLowerCase().includes(searchQuery)) return false;
    return true;
  });
  
  const tbody = document.getElementById('verificationTable');
  
  if (!filteredPolicies.length) {
    tbody.innerHTML = `
      <tr>
        <td colspan="8" style="text-align:center;color:var(--muted);padding:32px">
          No policies match your filters
        </td>
      </tr>
    `;
    return;
  }
  
  const statusClasses = {
    'Approved': 'badge-approved',
    'Rejected': 'badge-rejected',
    'Pending': 'badge-pending'
  };
  
  const riskClasses = {
    'High': 'badge-high',
    'Medium': 'badge-medium',
    'Low': 'badge-low'
  };
  
  tbody.innerHTML = filteredPolicies.map(policy => {
    const statusClass = statusClasses[policy.status];
    const riskClass = riskClasses[policy.riskLevel] || 'badge-low';
    
    const actions = policy.status === 'Pending' ? `
      <button class="btn btn-success btn-sm btn-icon" 
              onclick="updateStatus('${policy.id}','Approved')" 
              title="Approve">
        <i class="fas fa-check"></i>
      </button>
      <button class="btn btn-danger btn-sm btn-icon" 
              style="margin-left:6px" 
              onclick="updateStatus('${policy.id}','Rejected')" 
              title="Reject">
        <i class="fas fa-times"></i>
      </button>
    ` : `
      <span style="color:var(--muted);font-size:12px">
        <i class="fas fa-check-double"></i> Done
      </span>
    `;
    
    return `
      <tr>
        <td class="pol-num">${policy.policyNumber}</td>
        <td style="font-size:13px;color:var(--muted)">${policy.policyType?.replace(' Insurance', '')}</td>
        <td class="cust-name">${policy.customerName}</td>
        <td class="premium">$${policy.premiumAmount?.toLocaleString()}</td>
        <td><span class="badge ${riskClass}">${policy.riskLevel || 'Low'}</span></td>
        <td><span class="badge ${statusClass}">${policy.status}</span></td>
        <td style="color:var(--muted);font-size:13px">${policy.submittedDate}</td>
        <td>${actions}</td>
      </tr>
    `;
  }).join('');
}

function applyFilters() {
  currentFilters.status = document.getElementById('filterStatus').value;
  currentFilters.type = document.getElementById('filterType').value;
  currentFilters.risk = document.getElementById('filterRisk').value;
  loadVerificationTable();
}

function resetFilters() {
  currentFilters = { status: 'all', type: 'all', risk: 'all', search: '' };
  document.getElementById('filterStatus').value = 'all';
  document.getElementById('filterType').value = 'all';
  document.getElementById('filterRisk').value = 'all';
  document.getElementById('verifySearch').value = '';
  loadVerificationTable();
}

function updateStatus(policyId, newStatus) {
  const policies = getP();
  const policyIndex = policies.findIndex(p => p.id === policyId);
  
  if (policyIndex === -1) return;
  
  policies[policyIndex].status = newStatus;
  policies[policyIndex].reviewedDate = new Date().toLocaleDateString();
  
  setP(policies);
  loadVerificationTable();
  
  const activityType = newStatus === 'Approved' ? 'success' : 'danger';
  addActivity(`Policy ${newStatus.toLowerCase()}`, policies[policyIndex].policyNumber, activityType);
  updateNotifBadge(1);
}

async function runAIBatchVerification() {
  const statusElement = document.getElementById('verificationStatus');
  statusElement.innerHTML = 'AI analysing all pending policies‚Ä¶ <span class="spinner"></span>';
  
  const policies = getP();
  const pendingCount = policies.filter(p => p.status === 'Pending').length;
  
  setTimeout(() => {
    statusElement.innerHTML = `
      <i class="fas fa-check-circle" style="color:var(--teal)"></i> 
      Batch complete ‚Äî ${Math.max(0, pendingCount - 1)} auto-approved, 
      ${pendingCount > 0 ? 1 : 0} flagged for manual review.
    `;
  }, 2800);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DASHBOARD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateDashboard() {
  const policies = getP();
  const total = policies.length;
  const approved = policies.filter(p => p.status === 'Approved').length;
  const rejected = policies.filter(p => p.status === 'Rejected').length;
  const pending = policies.filter(p => p.status === 'Pending').length;
  
  animateNumber('totalPolicies', total);
  animateNumber('approvedPolicies', approved);
  animateNumber('rejectedPolicies', rejected);
  animateNumber('pendingPolicies', pending);
  
  const approvalPercentage = total > 0 ? Math.round(approved / total * 100) : 0;
  document.getElementById('progressBar').style.width = approvalPercentage + '%';
  document.getElementById('progressPercent').textContent = approvalPercentage + '%';
  
  const tbody = document.getElementById('dashboardTable');
  
  if (!policies.length) {
    tbody.innerHTML = `
      <tr>
        <td colspan="7" style="text-align:center;color:var(--muted);padding:32px">
          No policies yet ‚Äî create your first one!
        </td>
      </tr>
    `;
  } else {
    const statusClasses = {
      'Approved': 'badge-approved',
      'Rejected': 'badge-rejected',
      'Pending': 'badge-pending'
    };
    
    const riskClasses = {
      'High': 'badge-high',
      'Medium': 'badge-medium',
      'Low': 'badge-low'
    };
    
    tbody.innerHTML = [...policies].reverse().slice(0, 5).map(policy => `
      <tr>
        <td class="pol-num">${policy.policyNumber}</td>
        <td style="font-size:13px;color:var(--muted)">${policy.policyType?.replace(' Insurance', '')}</td>
        <td class="cust-name">${policy.customerName}</td>
        <td class="premium">$${policy.premiumAmount?.toLocaleString()}</td>
        <td style="color:var(--muted);font-size:13px">${policy.submittedDate}</td>
        <td><span class="badge ${statusClasses[policy.status] || 'badge-pending'}">${policy.status}</span></td>
        <td><span class="badge ${riskClasses[policy.riskLevel] || 'badge-low'}">${policy.riskLevel || 'Low'}</span></td>
      </tr>
    `).join('');
  }
  
  loadActivityTimeline();
  loadAIRecommendation();
  initCharts();
}

function animateNumber(elementId, targetValue) {
  const element = document.getElementById(elementId);
  const duration = 700;
  const startTime = performance.now();
  
  const animate = (currentTime) => {
    const progress = Math.min((currentTime - startTime) / duration, 1);
    element.textContent = Math.round(progress * targetValue);
    
    if (progress < 1) {
      requestAnimationFrame(animate);
    }
  };
  
  requestAnimationFrame(animate);
}

async function loadAIRecommendation() {
  const policies = getP();
  const element = document.getElementById('aiRecommendation');
  
  if (!policies.length) {
    element.innerHTML = '<strong>AI Insight:</strong> Add your first policy to receive personalised AI recommendations.';
    return;
  }
  
  element.innerHTML = '<strong>AI Insight:</strong> Analysing‚Ä¶ <span class="spinner"></span>';
  
  const approved = policies.filter(p => p.status === 'Approved').length;
  const pending = policies.filter(p => p.status === 'Pending').length;
  
  const prompt = `You are an insurance analytics AI. Based on ${policies.length} total policies, ${approved} approved, ${pending} pending: Give ONE concise, actionable recommendation in max 15 words. Start with an action verb.`;
  
  const recommendation = await callGemini(prompt);
  element.innerHTML = `<strong>AI Insight:</strong> ${recommendation}`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CHARTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const chartDefaults = {
  plugins: {
    legend: {
      labels: {
        color: '#cbd5e1',
        font: { family: 'Inter', size: 12 }
      }
    }
  },
  scales: {
    x: {
      grid: { color: 'rgba(148,163,184,0.1)', borderColor: 'rgba(148,163,184,0.15)' },
      ticks: { color: '#64748b', font: { size: 11 } }
    },
    y: {
      grid: { color: 'rgba(148,163,184,0.1)', borderColor: 'rgba(148,163,184,0.15)' },
      ticks: { color: '#64748b', font: { size: 11 } }
    }
  }
};

function initCharts() {
  const policies = getP();
  
  // Policy Types Bar Chart
  const typeMap = {};
  policies.forEach(policy => {
    typeMap[policy.policyType] = (typeMap[policy.policyType] || 0) + 1;
  });
  
  const types = Object.keys(typeMap);
  const counts = types.map(type => typeMap[type]);
  const colors = ['#3b82f6', '#14b8a6', '#f59e0b', '#8b5cf6', '#f43f5e', '#06b6d4'];
  
  destroyChart('barChart');
  if (document.getElementById('barChart')) {
    charts['barChart'] = new Chart(document.getElementById('barChart'), {
      type: 'bar',
      data: {
        labels: types.map(type => type.replace(' Insurance', '')),
        datasets: [{
          label: 'Policies',
          data: counts,
          backgroundColor: colors,
          borderRadius: 8,
          borderSkipped: false
        }]
      },
      options: {
        ...chartDefaults,
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          ...chartDefaults.plugins,
          legend: { display: false }
        }
      }
    });
  }
  
  // Status Doughnut Chart
  const approved = policies.filter(p => p.status === 'Approved').length;
  const rejected = policies.filter(p => p.status === 'Rejected').length;
  const pending = policies.filter(p => p.status === 'Pending').length;
  
  destroyChart('doughnutChart');
  if (document.getElementById('doughnutChart')) {
    charts['doughnutChart'] = new Chart(document.getElementById('doughnutChart'), {
      type: 'doughnut',
      data: {
        labels: ['Approved', 'Pending', 'Rejected'],
        datasets: [{
          data: [approved || 1, pending, rejected],
          backgroundColor: ['rgba(20,184,166,.85)', 'rgba(245,158,11,.85)', 'rgba(244,63,94,.85)'],
          borderWidth: 0,
          hoverOffset: 8
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom',
            labels: {
              color: '#cbd5e1',
              font: { size: 12 },
              padding: 14
            }
          }
        },
        cutout: '70%'
      }
    });
  }
  
  // Revenue Line Chart
  const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];
  const revenue = [82000, 104000, 91000, 138000, 122000, 165000];
  
  destroyChart('lineChart');
  if (document.getElementById('lineChart')) {
    charts['lineChart'] = new Chart(document.getElementById('lineChart'), {
      type: 'line',
      data: {
        labels: months,
        datasets: [{
          label: 'Revenue ($)',
          data: revenue,
          borderColor: '#3b82f6',
          backgroundColor: 'rgba(59,130,246,.12)',
          fill: true,
          tension: 0.45,
          pointBackgroundColor: '#3b82f6',
          pointRadius: 5,
          pointHoverRadius: 7
        }]
      },
      options: {
        ...chartDefaults,
        responsive: true,
        maintainAspectRatio: false
      }
    });
  }
  
  // Risk Distribution Chart
  const lowRisk = policies.filter(p => p.riskLevel === 'Low').length;
  const mediumRisk = policies.filter(p => p.riskLevel === 'Medium').length;
  const highRisk = policies.filter(p => p.riskLevel === 'High').length;
  
  destroyChart('riskChart');
  if (document.getElementById('riskChart')) {
    charts['riskChart'] = new Chart(document.getElementById('riskChart'), {
      type: 'bar',
      data: {
        labels: ['Low Risk', 'Medium Risk', 'High Risk'],
        datasets: [{
          label: 'Policies',
          data: [lowRisk || 2, mediumRisk || 1, highRisk || 0],
          backgroundColor: ['rgba(20,184,166,.75)', 'rgba(245,158,11,.75)', 'rgba(244,63,94,.75)'],
          borderRadius: 10,
          borderSkipped: false
        }]
      },
      options: {
        ...chartDefaults,
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          ...chartDefaults.plugins,
          legend: { display: false }
        }
      }
    });
  }
}

function initRadarChart() {
  destroyChart('radarChart');
  if (document.getElementById('radarChart')) {
    charts['radarChart'] = new Chart(document.getElementById('radarChart'), {
      type: 'radar',
      data: {
        labels: ['Life', 'Health', 'Auto', 'Home', 'Business', 'Travel'],
        datasets: [
          {
            label: 'This Year',
            data: [65, 80, 55, 70, 45, 60],
            borderColor: '#3b82f6',
            backgroundColor: 'rgba(59,130,246,.18)',
            pointBackgroundColor: '#3b82f6',
            pointRadius: 5
          },
          {
            label: 'Last Year',
            data: [50, 65, 70, 55, 40, 50],
            borderColor: '#8b5cf6',
            backgroundColor: 'rgba(139,92,246,.12)',
            pointBackgroundColor: '#8b5cf6',
            pointRadius: 5
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            labels: {
              color: '#cbd5e1',
              font: { size: 13 }
            }
          }
        },
        scales: {
          r: {
            grid: { color: 'rgba(148,163,184,.12)' },
            angleLines: { color: 'rgba(148,163,184,.12)' },
            ticks: {
              color: '#64748b',
              font: { size: 11 },
              backdropColor: 'transparent'
            },
            pointLabels: {
              color: '#cbd5e1',
              font: { size: 13 }
            }
          }
        }
      }
    });
  }
}

function initReportsLineChart() {
  destroyChart('reportsLineChart');
  if (!document.getElementById('reportsLineChart')) return;
  
  const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];
  
  charts['reportsLineChart'] = new Chart(document.getElementById('reportsLineChart'), {
    type: 'line',
    data: {
      labels: months,
      datasets: [
        {
          label: 'Total Policies',
          data: [45, 52, 48, 61, 58, 67],
          borderColor: '#3b82f6',
          backgroundColor: 'rgba(59,130,246,.1)',
          fill: true,
          tension: 0.4,
          pointRadius: 5
        },
        {
          label: 'Approved',
          data: [38, 44, 40, 53, 50, 59],
          borderColor: '#14b8a6',
          backgroundColor: 'rgba(20,184,166,.08)',
          fill: true,
          tension: 0.4,
          pointRadius: 5
        },
        {
          label: 'Rejected',
          data: [4, 5, 6, 5, 5, 4],
          borderColor: '#f43f5e',
          backgroundColor: 'rgba(244,63,94,.08)',
          fill: true,
          tension: 0.4,
          pointRadius: 5
        }
      ]
    },
    options: {
      ...chartDefaults,
      responsive: true,
      maintainAspectRatio: false
    }
  });
}

function destroyChart(chartId) {
  if (charts[chartId]) {
    charts[chartId].destroy();
    delete charts[chartId];
  }
}

function refreshCharts() {
  initCharts();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ACTIVITY TIMELINE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function addActivity(action, detail, type) {
  activities.unshift({
    action,
    detail,
    type,
    time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
  });
  
  if (activities.length > 10) activities.pop();
  
  loadActivityTimeline();
}

function loadActivityTimeline() {
  const element = document.getElementById('activityTimeline');
  if (!element) return;
  
  if (!activities.length) {
    element.innerHTML = `
      <p style="color:var(--muted);font-size:14px;text-align:center">
        No activity yet
      </p>
    `;
    return;
  }
  
  element.innerHTML = activities.map(activity => `
    <div class="tl-item">
      <div class="tl-dot ${activity.type}">
        <i class="fas fa-${activity.type === 'success' ? 'check' : activity.type === 'danger' ? 'times' : 'info'}"></i>
      </div>
      <div class="tl-title">${activity.action}</div>
      <div class="tl-sub">${activity.detail}</div>
      <div class="tl-time"><i class="fas fa-clock"></i> ${activity.time}</div>
    </div>
  `).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EMPLOYEE MANAGEMENT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function handleEmployeeSubmit(event) {
  event.preventDefault();
  
  const employee = {
    id: 'EMP' + Date.now(),
    name: document.getElementById('empName').value,
    email: document.getElementById('empEmail').value,
    phone: document.getElementById('empPhone').value,
    role: document.getElementById('empRole').value,
    department: document.getElementById('empDept').value
  };
  
  const employees = getE();
  employees.push(employee);
  setE(employees);
  
  const alertElement = document.getElementById('employeeSuccessAlert');
  alertElement.style.display = 'flex';
  setTimeout(() => alertElement.style.display = 'none', 3000);
  
  event.target.reset();
  loadEmployeeTable();
  
  addActivity('Team member added', employee.name, 'success');
}

function loadEmployeeTable() {
  const employees = getE();
  const tbody = document.getElementById('employeeTable');
  
  if (!employees.length) {
    tbody.innerHTML = `
      <tr>
        <td colspan="4" style="text-align:center;color:var(--muted);padding:28px">
          No team members yet
        </td>
      </tr>
    `;
    return;
  }
  
  const roleClasses = {
    Agent: 'badge-approved',
    Verifier: 'badge-low',
    Manager: 'badge-medium',
    Admin: 'badge-rejected'
  };
  
  tbody.innerHTML = employees.map(employee => `
    <tr>
      <td class="cust-name">${employee.name}</td>
      <td style="color:var(--muted);font-size:13px">${employee.email}</td>
      <td><span class="badge ${roleClasses[employee.role] || 'badge-pending'}">${employee.role}</span></td>
      <td style="color:var(--muted);font-size:13px">${employee.department}</td>
    </tr>
  `).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// REPORTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function loadReports() {
  const policies = getP();
  
  const totalRevenue = policies.reduce((sum, policy) => sum + policy.premiumAmount, 0);
  const avgPremium = policies.length ? Math.round(totalRevenue / policies.length) : 0;
  const approved = policies.filter(p => p.status === 'Approved').length;
  const approvalRate = policies.length ? Math.round(approved / policies.length * 100) : 0;
  
  document.getElementById('totalRevenue').textContent = '$' + (totalRevenue || 0).toLocaleString();
  document.getElementById('avgPremium').textContent = '$' + avgPremium.toLocaleString();
  document.getElementById('approvalRate').textContent = approvalRate + '%';
  
  const months = ['January', 'February', 'March', 'April', 'May', 'June'];
  const reportData = [
    { total: 45, approved: 38, rejected: 4, revenue: 125000, growth: 12 },
    { total: 52, approved: 44, rejected: 5, revenue: 142000, growth: 15 },
    { total: 48, approved: 40, rejected: 6, revenue: 134000, growth: -8 },
    { total: 61, approved: 53, rejected: 5, revenue: 168000, growth: 27 },
    { total: 58, approved: 50, rejected: 5, revenue: 159000, growth: -5 },
    { total: 67, approved: 59, rejected: 4, revenue: 185000, growth: 16 }
  ];
  
  document.getElementById('reportTable').innerHTML = months.map((month, index) => {
    const data = reportData[index];
    const isPositiveGrowth = data.growth > 0;
    
    return `
      <tr>
        <td style="font-weight:600">${month}</td>
        <td>${data.total}</td>
        <td style="color:var(--teal)">${data.approved}</td>
        <td style="color:var(--rose)">${data.rejected}</td>
        <td class="premium">$${data.revenue.toLocaleString()}</td>
        <td style="color:${isPositiveGrowth ? 'var(--emerald)' : 'var(--rose)'}">
          <i class="fas fa-arrow-${isPositiveGrowth ? 'up' : 'down'}"></i> ${Math.abs(data.growth)}%
        </td>
      </tr>
    `;
  }).join('');
  
  initReportsLineChart();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AI INSIGHTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function generateAIInsights() {
  const button = event.currentTarget;
  button.innerHTML = '<span class="spinner"></span> Generating‚Ä¶';
  
  setTimeout(() => {
    button.innerHTML = '<i class="fas fa-sparkles"></i> Regenerate';
    alert('AI Insights refreshed with latest data!');
  }, 2500);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ADVANCED ANALYTICS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initAdvancedAnalytics() {
  initMLForecast();
  initHeatmap();
  initSegmentChart();
}

function initMLForecast() {
  const options = {
    chart: {
      type: 'area',
      height: 300,
      foreColor: '#cbd5e1',
      background: 'transparent',
      toolbar: { show: false }
    },
    dataLabels: { enabled: false },
    series: [
      {
        name: 'Actual',
        data: [45, 52, 48, 61, 58, 67, 72, 85, 78, 91, 88, 95]
      },
      {
        name: 'Forecast',
        data: [null, null, null, null, null, null, 75, 88, 84, 96, 93, 102]
      }
    ],
    xaxis: {
      categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
      labels: { style: { colors: '#64748b' } }
    },
    yaxis: {
      labels: { style: { colors: '#64748b' } }
    },
    grid: { borderColor: 'rgba(148,163,184,0.1)' },
    tooltip: { theme: 'dark' },
    fill: {
      gradient: {
        enabled: true,
        opacityFrom: 0.6,
        opacityTo: 0.1
      }
    },
    colors: ['#3b82f6', '#8b5cf6']
  };
  
  if (forecastChart) forecastChart.destroy();
  
  forecastChart = new ApexCharts(document.querySelector("#forecastChart"), options);
  forecastChart.render();
}

function runMLForecast() {
  if (forecastChart) {
    forecastChart.destroy();
    setTimeout(initMLForecast, 300);
  }
}

function initHeatmap() {
  const heatmapElement = document.getElementById('heatmap');
  if (!heatmapElement) return;
  let html = '';
  
  for (let i = 0; i < 7; i++) {
    for (let j = 0; j < 7; j++) {
      const level = Math.floor(Math.random() * 5);
      html += `<div class="heatmap-cell" data-level="${level}" title="Activity: ${level * 20}%"></div>`;
    }
  }
  
  heatmapElement.innerHTML = html;
}

function initSegmentChart() {
  destroyChart('segmentChart');
  if (!document.getElementById('segmentChart')) return;
  
  charts['segmentChart'] = new Chart(document.getElementById('segmentChart'), {
    type: 'doughnut',
    data: {
      labels: ['Young Adults', 'Families', 'Seniors', 'Business'],
      datasets: [{
        data: [28, 45, 18, 9],
        backgroundColor: ['#3b82f6', '#14b8a6', '#f59e0b', '#8b5cf6'],
        borderWidth: 0,
        hoverOffset: 6
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          position: 'bottom',
          labels: {
            color: '#cbd5e1',
            padding: 12
          }
        }
      }
    }
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FRAUD DETECTION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateFraudDetection() {
  const policies = getP();
  const fraudPolicies = policies.filter(p => (p.fraudScore || 0) > 70);
  const avgFraudScore = policies.length
    ? Math.round(policies.reduce((sum, p) => sum + (p.fraudScore || 0), 0) / policies.length)
    : 0;
  
  document.getElementById('fraudScore').textContent = avgFraudScore;
  document.getElementById('fraudMeter').style.width = avgFraudScore + '%';
  document.getElementById('flaggedPolicies').textContent = fraudPolicies.length;
  document.getElementById('falsePositives').textContent = Math.round(fraudPolicies.length * 0.2);
  
  if (fraudPolicies.length > 0) {
    document.getElementById('fraudAlert').style.display = 'flex';
  }
  
  const tbody = document.getElementById('fraudTable');
  
  if (fraudPolicies.length === 0) {
    tbody.innerHTML = `
      <tr>
        <td colspan="6" style="text-align:center;color:var(--muted);padding:32px">
          No suspicious policies found
        </td>
      </tr>
    `;
  } else {
    tbody.innerHTML = fraudPolicies.map(policy => `
      <tr>
        <td class="pol-num">${policy.policyNumber}</td>
        <td>${policy.customerName}</td>
        <td class="premium">$${policy.premiumAmount?.toLocaleString()}</td>
        <td><span class="badge badge-fraud">${Math.round(policy.fraudScore)}%</span></td>
        <td style="color:var(--muted)">Unusual payment pattern</td>
        <td>
          <button class="btn btn-danger btn-sm" onclick="investigateFraud('${policy.id}')">
            Investigate
          </button>
        </td>
      </tr>
    `).join('');
  }
}

function investigateFraud(policyId) {
  alert(`Investigating policy ${policyId}...`);
}

function scanForFraud() {
  const alertElement = document.getElementById('fraudAlert');
  alertElement.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Scanning policies...';
  alertElement.style.display = 'flex';
  
  setTimeout(() => {
    alertElement.innerHTML = '<i class="fas fa-check-circle"></i> Scan complete - 3 suspicious policies found';
    updateFraudDetection();
  }, 2000);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// VOICE RECOGNITION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toggleVoiceRecognition() {
  if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
    alert('Voice recognition not supported in this browser');
    return;
  }
  
  const button = document.getElementById('voiceBtn');
  
  if (isListening) {
    if (recognition) recognition.stop();
    button.classList.remove('listening');
    button.innerHTML = '<i class="fas fa-microphone"></i>';
    isListening = false;
  } else {
    recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.continuous = false;
    recognition.interimResults = false;
    recognition.lang = 'en-US';
    
    recognition.onstart = () => {
      button.classList.add('listening');
      button.innerHTML = '<i class="fas fa-microphone-slash"></i>';
      isListening = true;
    };
    
    recognition.onresult = (event) => {
      const transcript = event.results[0][0].transcript;
      document.getElementById('chatInput').value = transcript;
      sendChat();
    };
    
    recognition.onerror = () => {
      button.classList.remove('listening');
      button.innerHTML = '<i class="fas fa-microphone"></i>';
      isListening = false;
    };
    
    recognition.onend = () => {
      button.classList.remove('listening');
      button.innerHTML = '<i class="fas fa-microphone"></i>';
      isListening = false;
    };
    
    recognition.start();
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EXPORT FUNCTIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function exportToFormat(format) {
  const data = {
    policies: getP(),
    employees: getE(),
    exportDate: new Date().toISOString(),
    metrics: {
      totalPolicies: getP().length,
      totalRevenue: getP().reduce((sum, p) => sum + p.premiumAmount, 0),
      approvalRate: getP().length
        ? Math.round(getP().filter(p => p.status === 'Approved').length / getP().length * 100)
        : 0
    }
  };
  
  let content, filename, type;
  
  switch (format) {
    case 'pdf':
      alert('PDF generation would happen here - showing data preview');
      console.log(data);
      return;
      
    case 'excel':
      content = convertToCSV(data.policies);
      filename = 'policies_export.xls';
      type = 'application/vnd.ms-excel';
      break;
      
    case 'csv':
      content = convertToCSV(data.policies);
      filename = 'policies_export.csv';
      type = 'text/csv';
      break;
      
    case 'json':
      content = JSON.stringify(data, null, 2);
      filename = 'insuretrack_backup.json';
      type = 'application/json';
      break;
  }
  
  const blob = new Blob([content], { type });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = filename;
  link.click();
  URL.revokeObjectURL(url);
}

function convertToCSV(array) {
  if (!array.length) return '';
  
  const headers = Object.keys(array[0]).filter(key => !key.includes('id') && key !== 'notes');
  const rows = array.map(obj => headers.map(header => `"${obj[header] || ''}"`).join(','));
  
  return [headers.join(','), ...rows].join('\n');
}

function exportReport(format) {
  exportToFormat(format);
}

function scheduleEmailReport() {
  alert('Email report scheduled! You will receive it monthly.');
}

function exportData() {
  exportToFormat('csv');
}

function exportAllData() {
  exportToFormat('json');
}

function backupData() {
  exportToFormat('json');
}

function confirmClearData() {
  if (confirm('‚ö†Ô∏è Delete ALL data permanently?') && confirm('Last chance ‚Äî are you sure?')) {
    setP([]);
    setE([]);
    location.reload();
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CHATBOT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toggleChat() {
  document.getElementById('chatWindow').classList.toggle('open');
}

function openChat() {
  document.getElementById('chatWindow').classList.add('open');
}

async function sendChat() {
  const input = document.getElementById('chatInput');
  const message = input.value.trim();
  
  if (!message) return;
  
  addChatMessage(message, true);
  input.value = '';
  
  // Add typing indicator
  const typingIndicator = document.createElement('div');
  typingIndicator.className = 'msg bot';
  typingIndicator.innerHTML = `
    <div class="msg-av bot"><i class="fas fa-robot"></i></div>
    <div class="msg-bubble">
      <div class="typing-dots">
        <span></span><span></span><span></span>
      </div>
    </div>
  `;
  document.getElementById('chatMessages').appendChild(typingIndicator);
  scrollChat();
  
  // Get AI response
  const response = await callGemini(
    `You are an expert insurance assistant. Answer this question in 2-3 concise sentences: ${message}`
  );
  
  typingIndicator.remove();
  addChatMessage(response, false);
}

function addChatMessage(text, isUser) {
  const messageDiv = document.createElement('div');
  messageDiv.className = `msg ${isUser ? 'user' : 'bot'}`;
  messageDiv.innerHTML = `
    <div class="msg-av ${isUser ? 'user' : 'bot'}">
      <i class="fas fa-${isUser ? 'user' : 'robot'}"></i>
    </div>
    <div class="msg-bubble">${text}</div>
  `;
  
  document.getElementById('chatMessages').appendChild(messageDiv);
  scrollChat();
}

function scrollChat() {
  const chatMessages = document.getElementById('chatMessages');
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INITIALIZATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.onload = function() {
  const currentUser = localStorage.getItem('currentUser');
  
  if (currentUser) {
    const user = JSON.parse(currentUser);
    
    document.getElementById('userName').textContent = user.username;
    document.getElementById('userRole').textContent = user.role;
    document.getElementById('userAvatar').textContent = user.initials || user.username.slice(0, 2).toUpperCase();
    
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('app').style.display = 'block';
    
    showScreen('dashboard');
  }
  
  // Add resize listener for responsive adjustments
  window.addEventListener('resize', function() {
    if (window.innerWidth >= 900) {
      document.getElementById('sidebar').classList.remove('open');
    }
  });
};

// Handle orientation change for mobile
window.addEventListener('orientationchange', function() {
  setTimeout(() => {
    if (window.innerWidth >= 900) {
      document.getElementById('sidebar').classList.remove('open');
    }
    refreshCharts();
  }, 100);
});
</script>
</body>
</html>